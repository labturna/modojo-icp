{"ast":null,"code":"/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport { findLast } from '../../../../base/common/arraysFind.js';\nimport { CancellationTokenSource } from '../../../../base/common/cancellation.js';\nimport { isHotReloadEnabled, registerHotReloadHandler } from '../../../../base/common/hotReload.js';\nimport { Disposable, DisposableStore, toDisposable } from '../../../../base/common/lifecycle.js';\nimport { autorun, autorunHandleChanges, autorunOpts, autorunWithStore, observableSignalFromEvent, observableValue, transaction } from '../../../../base/common/observable.js';\nimport { ElementSizeObserver } from '../../config/elementSizeObserver.js';\nimport { Position } from '../../../common/core/position.js';\nimport { Range } from '../../../common/core/range.js';\nimport { TextLength } from '../../../common/core/textLength.js';\nexport function joinCombine(arr1, arr2, keySelector, combine) {\n  if (arr1.length === 0) {\n    return arr2;\n  }\n  if (arr2.length === 0) {\n    return arr1;\n  }\n  const result = [];\n  let i = 0;\n  let j = 0;\n  while (i < arr1.length && j < arr2.length) {\n    const val1 = arr1[i];\n    const val2 = arr2[j];\n    const key1 = keySelector(val1);\n    const key2 = keySelector(val2);\n    if (key1 < key2) {\n      result.push(val1);\n      i++;\n    } else if (key1 > key2) {\n      result.push(val2);\n      j++;\n    } else {\n      result.push(combine(val1, val2));\n      i++;\n      j++;\n    }\n  }\n  while (i < arr1.length) {\n    result.push(arr1[i]);\n    i++;\n  }\n  while (j < arr2.length) {\n    result.push(arr2[j]);\n    j++;\n  }\n  return result;\n}\n// TODO make utility\nexport function applyObservableDecorations(editor, decorations) {\n  const d = new DisposableStore();\n  const decorationsCollection = editor.createDecorationsCollection();\n  d.add(autorunOpts({\n    debugName: () => `Apply decorations from ${decorations.debugName}`\n  }, reader => {\n    const d = decorations.read(reader);\n    decorationsCollection.set(d);\n  }));\n  d.add({\n    dispose: () => {\n      decorationsCollection.clear();\n    }\n  });\n  return d;\n}\nexport function appendRemoveOnDispose(parent, child) {\n  parent.appendChild(child);\n  return toDisposable(() => {\n    parent.removeChild(child);\n  });\n}\nexport function prependRemoveOnDispose(parent, child) {\n  parent.prepend(child);\n  return toDisposable(() => {\n    parent.removeChild(child);\n  });\n}\nexport class ObservableElementSizeObserver extends Disposable {\n  get width() {\n    return this._width;\n  }\n  get height() {\n    return this._height;\n  }\n  get automaticLayout() {\n    return this._automaticLayout;\n  }\n  constructor(element, dimension) {\n    super();\n    this._automaticLayout = false;\n    this.elementSizeObserver = this._register(new ElementSizeObserver(element, dimension));\n    this._width = observableValue(this, this.elementSizeObserver.getWidth());\n    this._height = observableValue(this, this.elementSizeObserver.getHeight());\n    this._register(this.elementSizeObserver.onDidChange(e => transaction(tx => {\n      /** @description Set width/height from elementSizeObserver */\n      this._width.set(this.elementSizeObserver.getWidth(), tx);\n      this._height.set(this.elementSizeObserver.getHeight(), tx);\n    })));\n  }\n  observe(dimension) {\n    this.elementSizeObserver.observe(dimension);\n  }\n  setAutomaticLayout(automaticLayout) {\n    this._automaticLayout = automaticLayout;\n    if (automaticLayout) {\n      this.elementSizeObserver.startObserving();\n    } else {\n      this.elementSizeObserver.stopObserving();\n    }\n  }\n}\nexport function animatedObservable(targetWindow, base, store) {\n  let targetVal = base.get();\n  let startVal = targetVal;\n  let curVal = targetVal;\n  const result = observableValue('animatedValue', targetVal);\n  let animationStartMs = -1;\n  const durationMs = 300;\n  let animationFrame = undefined;\n  store.add(autorunHandleChanges({\n    createEmptyChangeSummary: () => ({\n      animate: false\n    }),\n    handleChange: (ctx, s) => {\n      if (ctx.didChange(base)) {\n        s.animate = s.animate || ctx.change;\n      }\n      return true;\n    }\n  }, (reader, s) => {\n    /** @description update value */\n    if (animationFrame !== undefined) {\n      targetWindow.cancelAnimationFrame(animationFrame);\n      animationFrame = undefined;\n    }\n    startVal = curVal;\n    targetVal = base.read(reader);\n    animationStartMs = Date.now() - (s.animate ? 0 : durationMs);\n    update();\n  }));\n  function update() {\n    const passedMs = Date.now() - animationStartMs;\n    curVal = Math.floor(easeOutExpo(passedMs, startVal, targetVal - startVal, durationMs));\n    if (passedMs < durationMs) {\n      animationFrame = targetWindow.requestAnimationFrame(update);\n    } else {\n      curVal = targetVal;\n    }\n    result.set(curVal, undefined);\n  }\n  return result;\n}\nfunction easeOutExpo(t, b, c, d) {\n  return t === d ? b + c : c * (-Math.pow(2, -10 * t / d) + 1) + b;\n}\nexport class ViewZoneOverlayWidget extends Disposable {\n  constructor(editor, viewZone, htmlElement) {\n    super();\n    this._register(new ManagedOverlayWidget(editor, htmlElement));\n    this._register(applyStyle(htmlElement, {\n      height: viewZone.actualHeight,\n      top: viewZone.actualTop\n    }));\n  }\n}\nexport class PlaceholderViewZone {\n  get afterLineNumber() {\n    return this._afterLineNumber.get();\n  }\n  constructor(_afterLineNumber, heightInPx) {\n    this._afterLineNumber = _afterLineNumber;\n    this.heightInPx = heightInPx;\n    this.domNode = document.createElement('div');\n    this._actualTop = observableValue(this, undefined);\n    this._actualHeight = observableValue(this, undefined);\n    this.actualTop = this._actualTop;\n    this.actualHeight = this._actualHeight;\n    this.showInHiddenAreas = true;\n    this.onChange = this._afterLineNumber;\n    this.onDomNodeTop = top => {\n      this._actualTop.set(top, undefined);\n    };\n    this.onComputedHeight = height => {\n      this._actualHeight.set(height, undefined);\n    };\n  }\n}\nexport class ManagedOverlayWidget {\n  constructor(_editor, _domElement) {\n    this._editor = _editor;\n    this._domElement = _domElement;\n    this._overlayWidgetId = `managedOverlayWidget-${ManagedOverlayWidget._counter++}`;\n    this._overlayWidget = {\n      getId: () => this._overlayWidgetId,\n      getDomNode: () => this._domElement,\n      getPosition: () => null\n    };\n    this._editor.addOverlayWidget(this._overlayWidget);\n  }\n  dispose() {\n    this._editor.removeOverlayWidget(this._overlayWidget);\n  }\n}\nManagedOverlayWidget._counter = 0;\nexport function applyStyle(domNode, style) {\n  return autorun(reader => {\n    /** @description applyStyle */\n    for (let [key, val] of Object.entries(style)) {\n      if (val && typeof val === 'object' && 'read' in val) {\n        val = val.read(reader);\n      }\n      if (typeof val === 'number') {\n        val = `${val}px`;\n      }\n      key = key.replace(/[A-Z]/g, m => '-' + m.toLowerCase());\n      domNode.style[key] = val;\n    }\n  });\n}\nexport function readHotReloadableExport(value, reader) {\n  observeHotReloadableExports([value], reader);\n  return value;\n}\nexport function observeHotReloadableExports(values, reader) {\n  if (isHotReloadEnabled()) {\n    const o = observableSignalFromEvent('reload', event => registerHotReloadHandler(_ref => {\n      let {\n        oldExports\n      } = _ref;\n      if (![...Object.values(oldExports)].some(v => values.includes(v))) {\n        return undefined;\n      }\n      return _newExports => {\n        event(undefined);\n        return true;\n      };\n    }));\n    o.read(reader);\n  }\n}\nexport function applyViewZones(editor, viewZones, setIsUpdating, zoneIds) {\n  const store = new DisposableStore();\n  const lastViewZoneIds = [];\n  store.add(autorunWithStore((reader, store) => {\n    /** @description applyViewZones */\n    const curViewZones = viewZones.read(reader);\n    const viewZonIdsPerViewZone = new Map();\n    const viewZoneIdPerOnChangeObservable = new Map();\n    // Add/remove view zones\n    if (setIsUpdating) {\n      setIsUpdating(true);\n    }\n    editor.changeViewZones(a => {\n      for (const id of lastViewZoneIds) {\n        a.removeZone(id);\n        zoneIds === null || zoneIds === void 0 ? void 0 : zoneIds.delete(id);\n      }\n      lastViewZoneIds.length = 0;\n      for (const z of curViewZones) {\n        const id = a.addZone(z);\n        if (z.setZoneId) {\n          z.setZoneId(id);\n        }\n        lastViewZoneIds.push(id);\n        zoneIds === null || zoneIds === void 0 ? void 0 : zoneIds.add(id);\n        viewZonIdsPerViewZone.set(z, id);\n      }\n    });\n    if (setIsUpdating) {\n      setIsUpdating(false);\n    }\n    // Layout zone on change\n    store.add(autorunHandleChanges({\n      createEmptyChangeSummary() {\n        return {\n          zoneIds: []\n        };\n      },\n      handleChange(context, changeSummary) {\n        const id = viewZoneIdPerOnChangeObservable.get(context.changedObservable);\n        if (id !== undefined) {\n          changeSummary.zoneIds.push(id);\n        }\n        return true;\n      }\n    }, (reader, changeSummary) => {\n      /** @description layoutZone on change */\n      for (const vz of curViewZones) {\n        if (vz.onChange) {\n          viewZoneIdPerOnChangeObservable.set(vz.onChange, viewZonIdsPerViewZone.get(vz));\n          vz.onChange.read(reader);\n        }\n      }\n      if (setIsUpdating) {\n        setIsUpdating(true);\n      }\n      editor.changeViewZones(a => {\n        for (const id of changeSummary.zoneIds) {\n          a.layoutZone(id);\n        }\n      });\n      if (setIsUpdating) {\n        setIsUpdating(false);\n      }\n    }));\n  }));\n  store.add({\n    dispose() {\n      if (setIsUpdating) {\n        setIsUpdating(true);\n      }\n      editor.changeViewZones(a => {\n        for (const id of lastViewZoneIds) {\n          a.removeZone(id);\n        }\n      });\n      zoneIds === null || zoneIds === void 0 ? void 0 : zoneIds.clear();\n      if (setIsUpdating) {\n        setIsUpdating(false);\n      }\n    }\n  });\n  return store;\n}\nexport class DisposableCancellationTokenSource extends CancellationTokenSource {\n  dispose() {\n    super.dispose(true);\n  }\n}\nexport function translatePosition(posInOriginal, mappings) {\n  const mapping = findLast(mappings, m => m.original.startLineNumber <= posInOriginal.lineNumber);\n  if (!mapping) {\n    // No changes before the position\n    return Range.fromPositions(posInOriginal);\n  }\n  if (mapping.original.endLineNumberExclusive <= posInOriginal.lineNumber) {\n    const newLineNumber = posInOriginal.lineNumber - mapping.original.endLineNumberExclusive + mapping.modified.endLineNumberExclusive;\n    return Range.fromPositions(new Position(newLineNumber, posInOriginal.column));\n  }\n  if (!mapping.innerChanges) {\n    // Only for legacy algorithm\n    return Range.fromPositions(new Position(mapping.modified.startLineNumber, 1));\n  }\n  const innerMapping = findLast(mapping.innerChanges, m => m.originalRange.getStartPosition().isBeforeOrEqual(posInOriginal));\n  if (!innerMapping) {\n    const newLineNumber = posInOriginal.lineNumber - mapping.original.startLineNumber + mapping.modified.startLineNumber;\n    return Range.fromPositions(new Position(newLineNumber, posInOriginal.column));\n  }\n  if (innerMapping.originalRange.containsPosition(posInOriginal)) {\n    return innerMapping.modifiedRange;\n  } else {\n    const l = lengthBetweenPositions(innerMapping.originalRange.getEndPosition(), posInOriginal);\n    return Range.fromPositions(l.addToPosition(innerMapping.modifiedRange.getEndPosition()));\n  }\n}\nfunction lengthBetweenPositions(position1, position2) {\n  if (position1.lineNumber === position2.lineNumber) {\n    return new TextLength(0, position2.column - position1.column);\n  } else {\n    return new TextLength(position2.lineNumber - position1.lineNumber, position2.column - 1);\n  }\n}\nexport function filterWithPrevious(arr, filter) {\n  let prev;\n  return arr.filter(cur => {\n    const result = filter(cur, prev);\n    prev = cur;\n    return result;\n  });\n}","map":{"version":3,"names":["findLast","CancellationTokenSource","isHotReloadEnabled","registerHotReloadHandler","Disposable","DisposableStore","toDisposable","autorun","autorunHandleChanges","autorunOpts","autorunWithStore","observableSignalFromEvent","observableValue","transaction","ElementSizeObserver","Position","Range","TextLength","joinCombine","arr1","arr2","keySelector","combine","length","result","i","j","val1","val2","key1","key2","push","applyObservableDecorations","editor","decorations","d","decorationsCollection","createDecorationsCollection","add","debugName","reader","read","set","dispose","clear","appendRemoveOnDispose","parent","child","appendChild","removeChild","prependRemoveOnDispose","prepend","ObservableElementSizeObserver","width","_width","height","_height","automaticLayout","_automaticLayout","constructor","element","dimension","elementSizeObserver","_register","getWidth","getHeight","onDidChange","e","tx","observe","setAutomaticLayout","startObserving","stopObserving","animatedObservable","targetWindow","base","store","targetVal","get","startVal","curVal","animationStartMs","durationMs","animationFrame","undefined","createEmptyChangeSummary","animate","handleChange","ctx","s","didChange","change","cancelAnimationFrame","Date","now","update","passedMs","Math","floor","easeOutExpo","requestAnimationFrame","t","b","c","pow","ViewZoneOverlayWidget","viewZone","htmlElement","ManagedOverlayWidget","applyStyle","actualHeight","top","actualTop","PlaceholderViewZone","afterLineNumber","_afterLineNumber","heightInPx","domNode","document","createElement","_actualTop","_actualHeight","showInHiddenAreas","onChange","onDomNodeTop","onComputedHeight","_editor","_domElement","_overlayWidgetId","_counter","_overlayWidget","getId","getDomNode","getPosition","addOverlayWidget","removeOverlayWidget","style","key","val","Object","entries","replace","m","toLowerCase","readHotReloadableExport","value","observeHotReloadableExports","values","o","event","_ref","oldExports","some","v","includes","_newExports","applyViewZones","viewZones","setIsUpdating","zoneIds","lastViewZoneIds","curViewZones","viewZonIdsPerViewZone","Map","viewZoneIdPerOnChangeObservable","changeViewZones","a","id","removeZone","delete","z","addZone","setZoneId","context","changeSummary","changedObservable","vz","layoutZone","DisposableCancellationTokenSource","translatePosition","posInOriginal","mappings","mapping","original","startLineNumber","lineNumber","fromPositions","endLineNumberExclusive","newLineNumber","modified","column","innerChanges","innerMapping","originalRange","getStartPosition","isBeforeOrEqual","containsPosition","modifiedRange","l","lengthBetweenPositions","getEndPosition","addToPosition","position1","position2","filterWithPrevious","arr","filter","prev","cur"],"sources":["/home/arslan/modojo/node_modules/monaco-editor/esm/vs/editor/browser/widget/diffEditor/utils.js"],"sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport { findLast } from '../../../../base/common/arraysFind.js';\nimport { CancellationTokenSource } from '../../../../base/common/cancellation.js';\nimport { isHotReloadEnabled, registerHotReloadHandler } from '../../../../base/common/hotReload.js';\nimport { Disposable, DisposableStore, toDisposable } from '../../../../base/common/lifecycle.js';\nimport { autorun, autorunHandleChanges, autorunOpts, autorunWithStore, observableSignalFromEvent, observableValue, transaction } from '../../../../base/common/observable.js';\nimport { ElementSizeObserver } from '../../config/elementSizeObserver.js';\nimport { Position } from '../../../common/core/position.js';\nimport { Range } from '../../../common/core/range.js';\nimport { TextLength } from '../../../common/core/textLength.js';\nexport function joinCombine(arr1, arr2, keySelector, combine) {\n    if (arr1.length === 0) {\n        return arr2;\n    }\n    if (arr2.length === 0) {\n        return arr1;\n    }\n    const result = [];\n    let i = 0;\n    let j = 0;\n    while (i < arr1.length && j < arr2.length) {\n        const val1 = arr1[i];\n        const val2 = arr2[j];\n        const key1 = keySelector(val1);\n        const key2 = keySelector(val2);\n        if (key1 < key2) {\n            result.push(val1);\n            i++;\n        }\n        else if (key1 > key2) {\n            result.push(val2);\n            j++;\n        }\n        else {\n            result.push(combine(val1, val2));\n            i++;\n            j++;\n        }\n    }\n    while (i < arr1.length) {\n        result.push(arr1[i]);\n        i++;\n    }\n    while (j < arr2.length) {\n        result.push(arr2[j]);\n        j++;\n    }\n    return result;\n}\n// TODO make utility\nexport function applyObservableDecorations(editor, decorations) {\n    const d = new DisposableStore();\n    const decorationsCollection = editor.createDecorationsCollection();\n    d.add(autorunOpts({ debugName: () => `Apply decorations from ${decorations.debugName}` }, reader => {\n        const d = decorations.read(reader);\n        decorationsCollection.set(d);\n    }));\n    d.add({\n        dispose: () => {\n            decorationsCollection.clear();\n        }\n    });\n    return d;\n}\nexport function appendRemoveOnDispose(parent, child) {\n    parent.appendChild(child);\n    return toDisposable(() => {\n        parent.removeChild(child);\n    });\n}\nexport function prependRemoveOnDispose(parent, child) {\n    parent.prepend(child);\n    return toDisposable(() => {\n        parent.removeChild(child);\n    });\n}\nexport class ObservableElementSizeObserver extends Disposable {\n    get width() { return this._width; }\n    get height() { return this._height; }\n    get automaticLayout() { return this._automaticLayout; }\n    constructor(element, dimension) {\n        super();\n        this._automaticLayout = false;\n        this.elementSizeObserver = this._register(new ElementSizeObserver(element, dimension));\n        this._width = observableValue(this, this.elementSizeObserver.getWidth());\n        this._height = observableValue(this, this.elementSizeObserver.getHeight());\n        this._register(this.elementSizeObserver.onDidChange(e => transaction(tx => {\n            /** @description Set width/height from elementSizeObserver */\n            this._width.set(this.elementSizeObserver.getWidth(), tx);\n            this._height.set(this.elementSizeObserver.getHeight(), tx);\n        })));\n    }\n    observe(dimension) {\n        this.elementSizeObserver.observe(dimension);\n    }\n    setAutomaticLayout(automaticLayout) {\n        this._automaticLayout = automaticLayout;\n        if (automaticLayout) {\n            this.elementSizeObserver.startObserving();\n        }\n        else {\n            this.elementSizeObserver.stopObserving();\n        }\n    }\n}\nexport function animatedObservable(targetWindow, base, store) {\n    let targetVal = base.get();\n    let startVal = targetVal;\n    let curVal = targetVal;\n    const result = observableValue('animatedValue', targetVal);\n    let animationStartMs = -1;\n    const durationMs = 300;\n    let animationFrame = undefined;\n    store.add(autorunHandleChanges({\n        createEmptyChangeSummary: () => ({ animate: false }),\n        handleChange: (ctx, s) => {\n            if (ctx.didChange(base)) {\n                s.animate = s.animate || ctx.change;\n            }\n            return true;\n        }\n    }, (reader, s) => {\n        /** @description update value */\n        if (animationFrame !== undefined) {\n            targetWindow.cancelAnimationFrame(animationFrame);\n            animationFrame = undefined;\n        }\n        startVal = curVal;\n        targetVal = base.read(reader);\n        animationStartMs = Date.now() - (s.animate ? 0 : durationMs);\n        update();\n    }));\n    function update() {\n        const passedMs = Date.now() - animationStartMs;\n        curVal = Math.floor(easeOutExpo(passedMs, startVal, targetVal - startVal, durationMs));\n        if (passedMs < durationMs) {\n            animationFrame = targetWindow.requestAnimationFrame(update);\n        }\n        else {\n            curVal = targetVal;\n        }\n        result.set(curVal, undefined);\n    }\n    return result;\n}\nfunction easeOutExpo(t, b, c, d) {\n    return t === d ? b + c : c * (-Math.pow(2, -10 * t / d) + 1) + b;\n}\nexport class ViewZoneOverlayWidget extends Disposable {\n    constructor(editor, viewZone, htmlElement) {\n        super();\n        this._register(new ManagedOverlayWidget(editor, htmlElement));\n        this._register(applyStyle(htmlElement, {\n            height: viewZone.actualHeight,\n            top: viewZone.actualTop,\n        }));\n    }\n}\nexport class PlaceholderViewZone {\n    get afterLineNumber() { return this._afterLineNumber.get(); }\n    constructor(_afterLineNumber, heightInPx) {\n        this._afterLineNumber = _afterLineNumber;\n        this.heightInPx = heightInPx;\n        this.domNode = document.createElement('div');\n        this._actualTop = observableValue(this, undefined);\n        this._actualHeight = observableValue(this, undefined);\n        this.actualTop = this._actualTop;\n        this.actualHeight = this._actualHeight;\n        this.showInHiddenAreas = true;\n        this.onChange = this._afterLineNumber;\n        this.onDomNodeTop = (top) => {\n            this._actualTop.set(top, undefined);\n        };\n        this.onComputedHeight = (height) => {\n            this._actualHeight.set(height, undefined);\n        };\n    }\n}\nexport class ManagedOverlayWidget {\n    constructor(_editor, _domElement) {\n        this._editor = _editor;\n        this._domElement = _domElement;\n        this._overlayWidgetId = `managedOverlayWidget-${ManagedOverlayWidget._counter++}`;\n        this._overlayWidget = {\n            getId: () => this._overlayWidgetId,\n            getDomNode: () => this._domElement,\n            getPosition: () => null\n        };\n        this._editor.addOverlayWidget(this._overlayWidget);\n    }\n    dispose() {\n        this._editor.removeOverlayWidget(this._overlayWidget);\n    }\n}\nManagedOverlayWidget._counter = 0;\nexport function applyStyle(domNode, style) {\n    return autorun(reader => {\n        /** @description applyStyle */\n        for (let [key, val] of Object.entries(style)) {\n            if (val && typeof val === 'object' && 'read' in val) {\n                val = val.read(reader);\n            }\n            if (typeof val === 'number') {\n                val = `${val}px`;\n            }\n            key = key.replace(/[A-Z]/g, m => '-' + m.toLowerCase());\n            domNode.style[key] = val;\n        }\n    });\n}\nexport function readHotReloadableExport(value, reader) {\n    observeHotReloadableExports([value], reader);\n    return value;\n}\nexport function observeHotReloadableExports(values, reader) {\n    if (isHotReloadEnabled()) {\n        const o = observableSignalFromEvent('reload', event => registerHotReloadHandler(({ oldExports }) => {\n            if (![...Object.values(oldExports)].some(v => values.includes(v))) {\n                return undefined;\n            }\n            return (_newExports) => {\n                event(undefined);\n                return true;\n            };\n        }));\n        o.read(reader);\n    }\n}\nexport function applyViewZones(editor, viewZones, setIsUpdating, zoneIds) {\n    const store = new DisposableStore();\n    const lastViewZoneIds = [];\n    store.add(autorunWithStore((reader, store) => {\n        /** @description applyViewZones */\n        const curViewZones = viewZones.read(reader);\n        const viewZonIdsPerViewZone = new Map();\n        const viewZoneIdPerOnChangeObservable = new Map();\n        // Add/remove view zones\n        if (setIsUpdating) {\n            setIsUpdating(true);\n        }\n        editor.changeViewZones(a => {\n            for (const id of lastViewZoneIds) {\n                a.removeZone(id);\n                zoneIds === null || zoneIds === void 0 ? void 0 : zoneIds.delete(id);\n            }\n            lastViewZoneIds.length = 0;\n            for (const z of curViewZones) {\n                const id = a.addZone(z);\n                if (z.setZoneId) {\n                    z.setZoneId(id);\n                }\n                lastViewZoneIds.push(id);\n                zoneIds === null || zoneIds === void 0 ? void 0 : zoneIds.add(id);\n                viewZonIdsPerViewZone.set(z, id);\n            }\n        });\n        if (setIsUpdating) {\n            setIsUpdating(false);\n        }\n        // Layout zone on change\n        store.add(autorunHandleChanges({\n            createEmptyChangeSummary() {\n                return { zoneIds: [] };\n            },\n            handleChange(context, changeSummary) {\n                const id = viewZoneIdPerOnChangeObservable.get(context.changedObservable);\n                if (id !== undefined) {\n                    changeSummary.zoneIds.push(id);\n                }\n                return true;\n            },\n        }, (reader, changeSummary) => {\n            /** @description layoutZone on change */\n            for (const vz of curViewZones) {\n                if (vz.onChange) {\n                    viewZoneIdPerOnChangeObservable.set(vz.onChange, viewZonIdsPerViewZone.get(vz));\n                    vz.onChange.read(reader);\n                }\n            }\n            if (setIsUpdating) {\n                setIsUpdating(true);\n            }\n            editor.changeViewZones(a => { for (const id of changeSummary.zoneIds) {\n                a.layoutZone(id);\n            } });\n            if (setIsUpdating) {\n                setIsUpdating(false);\n            }\n        }));\n    }));\n    store.add({\n        dispose() {\n            if (setIsUpdating) {\n                setIsUpdating(true);\n            }\n            editor.changeViewZones(a => { for (const id of lastViewZoneIds) {\n                a.removeZone(id);\n            } });\n            zoneIds === null || zoneIds === void 0 ? void 0 : zoneIds.clear();\n            if (setIsUpdating) {\n                setIsUpdating(false);\n            }\n        }\n    });\n    return store;\n}\nexport class DisposableCancellationTokenSource extends CancellationTokenSource {\n    dispose() {\n        super.dispose(true);\n    }\n}\nexport function translatePosition(posInOriginal, mappings) {\n    const mapping = findLast(mappings, m => m.original.startLineNumber <= posInOriginal.lineNumber);\n    if (!mapping) {\n        // No changes before the position\n        return Range.fromPositions(posInOriginal);\n    }\n    if (mapping.original.endLineNumberExclusive <= posInOriginal.lineNumber) {\n        const newLineNumber = posInOriginal.lineNumber - mapping.original.endLineNumberExclusive + mapping.modified.endLineNumberExclusive;\n        return Range.fromPositions(new Position(newLineNumber, posInOriginal.column));\n    }\n    if (!mapping.innerChanges) {\n        // Only for legacy algorithm\n        return Range.fromPositions(new Position(mapping.modified.startLineNumber, 1));\n    }\n    const innerMapping = findLast(mapping.innerChanges, m => m.originalRange.getStartPosition().isBeforeOrEqual(posInOriginal));\n    if (!innerMapping) {\n        const newLineNumber = posInOriginal.lineNumber - mapping.original.startLineNumber + mapping.modified.startLineNumber;\n        return Range.fromPositions(new Position(newLineNumber, posInOriginal.column));\n    }\n    if (innerMapping.originalRange.containsPosition(posInOriginal)) {\n        return innerMapping.modifiedRange;\n    }\n    else {\n        const l = lengthBetweenPositions(innerMapping.originalRange.getEndPosition(), posInOriginal);\n        return Range.fromPositions(l.addToPosition(innerMapping.modifiedRange.getEndPosition()));\n    }\n}\nfunction lengthBetweenPositions(position1, position2) {\n    if (position1.lineNumber === position2.lineNumber) {\n        return new TextLength(0, position2.column - position1.column);\n    }\n    else {\n        return new TextLength(position2.lineNumber - position1.lineNumber, position2.column - 1);\n    }\n}\nexport function filterWithPrevious(arr, filter) {\n    let prev;\n    return arr.filter(cur => {\n        const result = filter(cur, prev);\n        prev = cur;\n        return result;\n    });\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}