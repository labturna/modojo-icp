{"ast":null,"code":"/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nvar __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n    r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n    d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nvar __param = this && this.__param || function (paramIndex, decorator) {\n  return function (target, key) {\n    decorator(target, key, paramIndex);\n  };\n};\nimport { getWindow, h, scheduleAtNextAnimationFrame } from '../../../../base/browser/dom.js';\nimport { SmoothScrollableElement } from '../../../../base/browser/ui/scrollbar/scrollableElement.js';\nimport { compareBy, numberComparator } from '../../../../base/common/arrays.js';\nimport { findFirstMax } from '../../../../base/common/arraysFind.js';\nimport { BugIndicatingError } from '../../../../base/common/errors.js';\nimport { Disposable, toDisposable } from '../../../../base/common/lifecycle.js';\nimport { autorun, autorunWithStore, derived, derivedWithStore, observableFromEvent, observableValue } from '../../../../base/common/observable.js';\nimport { disposableObservableValue, globalTransaction, transaction } from '../../../../base/common/observableInternal/base.js';\nimport { Scrollable } from '../../../../base/common/scrollable.js';\nimport './style.css';\nimport { ObservableElementSizeObserver } from '../diffEditor/utils.js';\nimport { OffsetRange } from '../../../common/core/offsetRange.js';\nimport { Selection } from '../../../common/core/selection.js';\nimport { EditorContextKeys } from '../../../common/editorContextKeys.js';\nimport { IContextKeyService } from '../../../../platform/contextkey/common/contextkey.js';\nimport { IInstantiationService } from '../../../../platform/instantiation/common/instantiation.js';\nimport { ServiceCollection } from '../../../../platform/instantiation/common/serviceCollection.js';\nimport { DiffEditorItemTemplate, TemplateData } from './diffEditorItemTemplate.js';\nimport { ObjectPool } from './objectPool.js';\nimport { localize } from '../../../../nls.js';\nlet MultiDiffEditorWidgetImpl = class MultiDiffEditorWidgetImpl extends Disposable {\n  constructor(_element, _dimension, _viewModel, _workbenchUIElementFactory, _parentContextKeyService, _parentInstantiationService) {\n    super();\n    this._element = _element;\n    this._dimension = _dimension;\n    this._viewModel = _viewModel;\n    this._workbenchUIElementFactory = _workbenchUIElementFactory;\n    this._parentContextKeyService = _parentContextKeyService;\n    this._parentInstantiationService = _parentInstantiationService;\n    this._scrollableElements = h('div.scrollContent', [h('div@content', {\n      style: {\n        overflow: 'hidden'\n      }\n    }), h('div.monaco-editor@overflowWidgetsDomNode', {})]);\n    this._scrollable = this._register(new Scrollable({\n      forceIntegerValues: false,\n      scheduleAtNextAnimationFrame: cb => scheduleAtNextAnimationFrame(getWindow(this._element), cb),\n      smoothScrollDuration: 100\n    }));\n    this._scrollableElement = this._register(new SmoothScrollableElement(this._scrollableElements.root, {\n      vertical: 1 /* ScrollbarVisibility.Auto */,\n      horizontal: 1 /* ScrollbarVisibility.Auto */,\n      useShadows: false\n    }, this._scrollable));\n    this._elements = h('div.monaco-component.multiDiffEditor', {}, [h('div', {}, [this._scrollableElement.getDomNode()]), h('div.placeholder@placeholder', {}, [h('div', [localize('noChangedFiles', 'No Changed Files')])])]);\n    this._sizeObserver = this._register(new ObservableElementSizeObserver(this._element, undefined));\n    this._objectPool = this._register(new ObjectPool(data => {\n      const template = this._instantiationService.createInstance(DiffEditorItemTemplate, this._scrollableElements.content, this._scrollableElements.overflowWidgetsDomNode, this._workbenchUIElementFactory);\n      template.setData(data);\n      return template;\n    }));\n    this.scrollTop = observableFromEvent(this._scrollableElement.onScroll, () => /** @description scrollTop */this._scrollableElement.getScrollPosition().scrollTop);\n    this.scrollLeft = observableFromEvent(this._scrollableElement.onScroll, () => /** @description scrollLeft */this._scrollableElement.getScrollPosition().scrollLeft);\n    this._viewItemsInfo = derivedWithStore(this, (reader, store) => {\n      const vm = this._viewModel.read(reader);\n      if (!vm) {\n        return {\n          items: [],\n          getItem: _d => {\n            throw new BugIndicatingError();\n          }\n        };\n      }\n      const viewModels = vm.items.read(reader);\n      const map = new Map();\n      const items = viewModels.map(d => {\n        var _a;\n        const item = store.add(new VirtualizedViewItem(d, this._objectPool, this.scrollLeft, delta => {\n          this._scrollableElement.setScrollPosition({\n            scrollTop: this._scrollableElement.getScrollPosition().scrollTop + delta\n          });\n        }));\n        const data = (_a = this._lastDocStates) === null || _a === void 0 ? void 0 : _a[item.getKey()];\n        if (data) {\n          transaction(tx => {\n            item.setViewState(data, tx);\n          });\n        }\n        map.set(d, item);\n        return item;\n      });\n      return {\n        items,\n        getItem: d => map.get(d)\n      };\n    });\n    this._viewItems = this._viewItemsInfo.map(this, items => items.items);\n    this._spaceBetweenPx = 0;\n    this._totalHeight = this._viewItems.map(this, (items, reader) => items.reduce((r, i) => r + i.contentHeight.read(reader) + this._spaceBetweenPx, 0));\n    this._contextKeyService = this._register(this._parentContextKeyService.createScoped(this._element));\n    this._instantiationService = this._register(this._parentInstantiationService.createChild(new ServiceCollection([IContextKeyService, this._contextKeyService])));\n    /** This accounts for documents that are not loaded yet. */\n    this._lastDocStates = {};\n    this._contextKeyService.createKey(EditorContextKeys.inMultiDiffEditor.key, true);\n    this._register(autorunWithStore((reader, store) => {\n      const viewModel = this._viewModel.read(reader);\n      if (viewModel && viewModel.contextKeys) {\n        for (const [key, value] of Object.entries(viewModel.contextKeys)) {\n          const contextKey = this._contextKeyService.createKey(key, undefined);\n          contextKey.set(value);\n          store.add(toDisposable(() => contextKey.reset()));\n        }\n      }\n    }));\n    const ctxAllCollapsed = this._parentContextKeyService.createKey(EditorContextKeys.multiDiffEditorAllCollapsed.key, false);\n    this._register(autorun(reader => {\n      const viewModel = this._viewModel.read(reader);\n      if (viewModel) {\n        const allCollapsed = viewModel.items.read(reader).every(item => item.collapsed.read(reader));\n        ctxAllCollapsed.set(allCollapsed);\n      }\n    }));\n    this._register(autorun(reader => {\n      /** @description Update widget dimension */\n      const dimension = this._dimension.read(reader);\n      this._sizeObserver.observe(dimension);\n    }));\n    this._register(autorun(reader => {\n      /** @description Update widget dimension */\n      const items = this._viewItems.read(reader);\n      this._elements.placeholder.classList.toggle('visible', items.length === 0);\n    }));\n    this._scrollableElements.content.style.position = 'relative';\n    this._register(autorun(reader => {\n      /** @description Update scroll dimensions */\n      const height = this._sizeObserver.height.read(reader);\n      this._scrollableElements.root.style.height = `${height}px`;\n      const totalHeight = this._totalHeight.read(reader);\n      this._scrollableElements.content.style.height = `${totalHeight}px`;\n      const width = this._sizeObserver.width.read(reader);\n      let scrollWidth = width;\n      const viewItems = this._viewItems.read(reader);\n      const max = findFirstMax(viewItems, compareBy(i => i.maxScroll.read(reader).maxScroll, numberComparator));\n      if (max) {\n        const maxScroll = max.maxScroll.read(reader);\n        scrollWidth = width + maxScroll.maxScroll;\n      }\n      this._scrollableElement.setScrollDimensions({\n        width: width,\n        height: height,\n        scrollHeight: totalHeight,\n        scrollWidth\n      });\n    }));\n    _element.replaceChildren(this._elements.root);\n    this._register(toDisposable(() => {\n      _element.replaceChildren();\n    }));\n    this._register(this._register(autorun(reader => {\n      /** @description Render all */\n      globalTransaction(tx => {\n        this.render(reader);\n      });\n    })));\n  }\n  render(reader) {\n    const scrollTop = this.scrollTop.read(reader);\n    let contentScrollOffsetToScrollOffset = 0;\n    let itemHeightSumBefore = 0;\n    let itemContentHeightSumBefore = 0;\n    const viewPortHeight = this._sizeObserver.height.read(reader);\n    const contentViewPort = OffsetRange.ofStartAndLength(scrollTop, viewPortHeight);\n    const width = this._sizeObserver.width.read(reader);\n    for (const v of this._viewItems.read(reader)) {\n      const itemContentHeight = v.contentHeight.read(reader);\n      const itemHeight = Math.min(itemContentHeight, viewPortHeight);\n      const itemRange = OffsetRange.ofStartAndLength(itemHeightSumBefore, itemHeight);\n      const itemContentRange = OffsetRange.ofStartAndLength(itemContentHeightSumBefore, itemContentHeight);\n      if (itemContentRange.isBefore(contentViewPort)) {\n        contentScrollOffsetToScrollOffset -= itemContentHeight - itemHeight;\n        v.hide();\n      } else if (itemContentRange.isAfter(contentViewPort)) {\n        v.hide();\n      } else {\n        const scroll = Math.max(0, Math.min(contentViewPort.start - itemContentRange.start, itemContentHeight - itemHeight));\n        contentScrollOffsetToScrollOffset -= scroll;\n        const viewPort = OffsetRange.ofStartAndLength(scrollTop + contentScrollOffsetToScrollOffset, viewPortHeight);\n        v.render(itemRange, scroll, width, viewPort);\n      }\n      itemHeightSumBefore += itemHeight + this._spaceBetweenPx;\n      itemContentHeightSumBefore += itemContentHeight + this._spaceBetweenPx;\n    }\n    this._scrollableElements.content.style.transform = `translateY(${-(scrollTop + contentScrollOffsetToScrollOffset)}px)`;\n  }\n};\nMultiDiffEditorWidgetImpl = __decorate([__param(4, IContextKeyService), __param(5, IInstantiationService)], MultiDiffEditorWidgetImpl);\nexport { MultiDiffEditorWidgetImpl };\nclass VirtualizedViewItem extends Disposable {\n  constructor(viewModel, _objectPool, _scrollLeft, _deltaScrollVertical) {\n    super();\n    this.viewModel = viewModel;\n    this._objectPool = _objectPool;\n    this._scrollLeft = _scrollLeft;\n    this._deltaScrollVertical = _deltaScrollVertical;\n    this._templateRef = this._register(disposableObservableValue(this, undefined));\n    this.contentHeight = derived(this, reader => {\n      var _a, _b, _c;\n      return (_c = (_b = (_a = this._templateRef.read(reader)) === null || _a === void 0 ? void 0 : _a.object.contentHeight) === null || _b === void 0 ? void 0 : _b.read(reader)) !== null && _c !== void 0 ? _c : this.viewModel.lastTemplateData.read(reader).contentHeight;\n    });\n    this.maxScroll = derived(this, reader => {\n      var _a, _b;\n      return (_b = (_a = this._templateRef.read(reader)) === null || _a === void 0 ? void 0 : _a.object.maxScroll.read(reader)) !== null && _b !== void 0 ? _b : {\n        maxScroll: 0,\n        scrollWidth: 0\n      };\n    });\n    this.template = derived(this, reader => {\n      var _a;\n      return (_a = this._templateRef.read(reader)) === null || _a === void 0 ? void 0 : _a.object;\n    });\n    this._isHidden = observableValue(this, false);\n    this._isFocused = derived(this, reader => {\n      var _a, _b;\n      return (_b = (_a = this.template.read(reader)) === null || _a === void 0 ? void 0 : _a.isFocused.read(reader)) !== null && _b !== void 0 ? _b : false;\n    });\n    this.viewModel.setIsFocused(this._isFocused, undefined);\n    this._register(autorun(reader => {\n      var _a;\n      const scrollLeft = this._scrollLeft.read(reader);\n      (_a = this._templateRef.read(reader)) === null || _a === void 0 ? void 0 : _a.object.setScrollLeft(scrollLeft);\n    }));\n    this._register(autorun(reader => {\n      const ref = this._templateRef.read(reader);\n      if (!ref) {\n        return;\n      }\n      const isHidden = this._isHidden.read(reader);\n      if (!isHidden) {\n        return;\n      }\n      const isFocused = ref.object.isFocused.read(reader);\n      if (isFocused) {\n        return;\n      }\n      this._clear();\n    }));\n  }\n  dispose() {\n    this._clear();\n    super.dispose();\n  }\n  toString() {\n    var _a;\n    return `VirtualViewItem(${(_a = this.viewModel.entry.value.modified) === null || _a === void 0 ? void 0 : _a.uri.toString()})`;\n  }\n  getKey() {\n    return this.viewModel.getKey();\n  }\n  setViewState(viewState, tx) {\n    var _a;\n    this.viewModel.collapsed.set(viewState.collapsed, tx);\n    this._updateTemplateData(tx);\n    const data = this.viewModel.lastTemplateData.get();\n    const selections = (_a = viewState.selections) === null || _a === void 0 ? void 0 : _a.map(Selection.liftSelection);\n    this.viewModel.lastTemplateData.set({\n      ...data,\n      selections\n    }, tx);\n    const ref = this._templateRef.get();\n    if (ref) {\n      if (selections) {\n        ref.object.editor.setSelections(selections);\n      }\n    }\n  }\n  _updateTemplateData(tx) {\n    var _a;\n    const ref = this._templateRef.get();\n    if (!ref) {\n      return;\n    }\n    this.viewModel.lastTemplateData.set({\n      contentHeight: ref.object.contentHeight.get(),\n      selections: (_a = ref.object.editor.getSelections()) !== null && _a !== void 0 ? _a : undefined\n    }, tx);\n  }\n  _clear() {\n    const ref = this._templateRef.get();\n    if (!ref) {\n      return;\n    }\n    transaction(tx => {\n      this._updateTemplateData(tx);\n      ref.object.hide();\n      this._templateRef.set(undefined, tx);\n    });\n  }\n  hide() {\n    this._isHidden.set(true, undefined);\n  }\n  render(verticalSpace, offset, width, viewPort) {\n    this._isHidden.set(false, undefined);\n    let ref = this._templateRef.get();\n    if (!ref) {\n      ref = this._objectPool.getUnusedObj(new TemplateData(this.viewModel, this._deltaScrollVertical));\n      this._templateRef.set(ref, undefined);\n      const selections = this.viewModel.lastTemplateData.get().selections;\n      if (selections) {\n        ref.object.editor.setSelections(selections);\n      }\n    }\n    ref.object.render(verticalSpace, width, offset, viewPort);\n  }\n}","map":{"version":3,"names":["__decorate","decorators","target","key","desc","c","arguments","length","r","Object","getOwnPropertyDescriptor","d","Reflect","decorate","i","defineProperty","__param","paramIndex","decorator","getWindow","h","scheduleAtNextAnimationFrame","SmoothScrollableElement","compareBy","numberComparator","findFirstMax","BugIndicatingError","Disposable","toDisposable","autorun","autorunWithStore","derived","derivedWithStore","observableFromEvent","observableValue","disposableObservableValue","globalTransaction","transaction","Scrollable","ObservableElementSizeObserver","OffsetRange","Selection","EditorContextKeys","IContextKeyService","IInstantiationService","ServiceCollection","DiffEditorItemTemplate","TemplateData","ObjectPool","localize","MultiDiffEditorWidgetImpl","constructor","_element","_dimension","_viewModel","_workbenchUIElementFactory","_parentContextKeyService","_parentInstantiationService","_scrollableElements","style","overflow","_scrollable","_register","forceIntegerValues","cb","smoothScrollDuration","_scrollableElement","root","vertical","horizontal","useShadows","_elements","getDomNode","_sizeObserver","undefined","_objectPool","data","template","_instantiationService","createInstance","content","overflowWidgetsDomNode","setData","scrollTop","onScroll","getScrollPosition","scrollLeft","_viewItemsInfo","reader","store","vm","read","items","getItem","_d","viewModels","map","Map","_a","item","add","VirtualizedViewItem","delta","setScrollPosition","_lastDocStates","getKey","tx","setViewState","set","get","_viewItems","_spaceBetweenPx","_totalHeight","reduce","contentHeight","_contextKeyService","createScoped","createChild","createKey","inMultiDiffEditor","viewModel","contextKeys","value","entries","contextKey","reset","ctxAllCollapsed","multiDiffEditorAllCollapsed","allCollapsed","every","collapsed","dimension","observe","placeholder","classList","toggle","position","height","totalHeight","width","scrollWidth","viewItems","max","maxScroll","setScrollDimensions","scrollHeight","replaceChildren","render","contentScrollOffsetToScrollOffset","itemHeightSumBefore","itemContentHeightSumBefore","viewPortHeight","contentViewPort","ofStartAndLength","v","itemContentHeight","itemHeight","Math","min","itemRange","itemContentRange","isBefore","hide","isAfter","scroll","start","viewPort","transform","_scrollLeft","_deltaScrollVertical","_templateRef","_b","_c","object","lastTemplateData","_isHidden","_isFocused","isFocused","setIsFocused","setScrollLeft","ref","isHidden","_clear","dispose","toString","entry","modified","uri","viewState","_updateTemplateData","selections","liftSelection","editor","setSelections","getSelections","verticalSpace","offset","getUnusedObj"],"sources":["/home/arslan/modojo/node_modules/monaco-editor/esm/vs/editor/browser/widget/multiDiffEditor/multiDiffEditorWidgetImpl.js"],"sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nvar __param = (this && this.__param) || function (paramIndex, decorator) {\n    return function (target, key) { decorator(target, key, paramIndex); }\n};\nimport { getWindow, h, scheduleAtNextAnimationFrame } from '../../../../base/browser/dom.js';\nimport { SmoothScrollableElement } from '../../../../base/browser/ui/scrollbar/scrollableElement.js';\nimport { compareBy, numberComparator } from '../../../../base/common/arrays.js';\nimport { findFirstMax } from '../../../../base/common/arraysFind.js';\nimport { BugIndicatingError } from '../../../../base/common/errors.js';\nimport { Disposable, toDisposable } from '../../../../base/common/lifecycle.js';\nimport { autorun, autorunWithStore, derived, derivedWithStore, observableFromEvent, observableValue } from '../../../../base/common/observable.js';\nimport { disposableObservableValue, globalTransaction, transaction } from '../../../../base/common/observableInternal/base.js';\nimport { Scrollable } from '../../../../base/common/scrollable.js';\nimport './style.css';\nimport { ObservableElementSizeObserver } from '../diffEditor/utils.js';\nimport { OffsetRange } from '../../../common/core/offsetRange.js';\nimport { Selection } from '../../../common/core/selection.js';\nimport { EditorContextKeys } from '../../../common/editorContextKeys.js';\nimport { IContextKeyService } from '../../../../platform/contextkey/common/contextkey.js';\nimport { IInstantiationService } from '../../../../platform/instantiation/common/instantiation.js';\nimport { ServiceCollection } from '../../../../platform/instantiation/common/serviceCollection.js';\nimport { DiffEditorItemTemplate, TemplateData } from './diffEditorItemTemplate.js';\nimport { ObjectPool } from './objectPool.js';\nimport { localize } from '../../../../nls.js';\nlet MultiDiffEditorWidgetImpl = class MultiDiffEditorWidgetImpl extends Disposable {\n    constructor(_element, _dimension, _viewModel, _workbenchUIElementFactory, _parentContextKeyService, _parentInstantiationService) {\n        super();\n        this._element = _element;\n        this._dimension = _dimension;\n        this._viewModel = _viewModel;\n        this._workbenchUIElementFactory = _workbenchUIElementFactory;\n        this._parentContextKeyService = _parentContextKeyService;\n        this._parentInstantiationService = _parentInstantiationService;\n        this._scrollableElements = h('div.scrollContent', [\n            h('div@content', {\n                style: {\n                    overflow: 'hidden',\n                }\n            }),\n            h('div.monaco-editor@overflowWidgetsDomNode', {}),\n        ]);\n        this._scrollable = this._register(new Scrollable({\n            forceIntegerValues: false,\n            scheduleAtNextAnimationFrame: (cb) => scheduleAtNextAnimationFrame(getWindow(this._element), cb),\n            smoothScrollDuration: 100,\n        }));\n        this._scrollableElement = this._register(new SmoothScrollableElement(this._scrollableElements.root, {\n            vertical: 1 /* ScrollbarVisibility.Auto */,\n            horizontal: 1 /* ScrollbarVisibility.Auto */,\n            useShadows: false,\n        }, this._scrollable));\n        this._elements = h('div.monaco-component.multiDiffEditor', {}, [\n            h('div', {}, [this._scrollableElement.getDomNode()]),\n            h('div.placeholder@placeholder', {}, [h('div', [localize('noChangedFiles', 'No Changed Files')])]),\n        ]);\n        this._sizeObserver = this._register(new ObservableElementSizeObserver(this._element, undefined));\n        this._objectPool = this._register(new ObjectPool((data) => {\n            const template = this._instantiationService.createInstance(DiffEditorItemTemplate, this._scrollableElements.content, this._scrollableElements.overflowWidgetsDomNode, this._workbenchUIElementFactory);\n            template.setData(data);\n            return template;\n        }));\n        this.scrollTop = observableFromEvent(this._scrollableElement.onScroll, () => /** @description scrollTop */ this._scrollableElement.getScrollPosition().scrollTop);\n        this.scrollLeft = observableFromEvent(this._scrollableElement.onScroll, () => /** @description scrollLeft */ this._scrollableElement.getScrollPosition().scrollLeft);\n        this._viewItemsInfo = derivedWithStore(this, (reader, store) => {\n            const vm = this._viewModel.read(reader);\n            if (!vm) {\n                return { items: [], getItem: _d => { throw new BugIndicatingError(); } };\n            }\n            const viewModels = vm.items.read(reader);\n            const map = new Map();\n            const items = viewModels.map(d => {\n                var _a;\n                const item = store.add(new VirtualizedViewItem(d, this._objectPool, this.scrollLeft, delta => {\n                    this._scrollableElement.setScrollPosition({ scrollTop: this._scrollableElement.getScrollPosition().scrollTop + delta });\n                }));\n                const data = (_a = this._lastDocStates) === null || _a === void 0 ? void 0 : _a[item.getKey()];\n                if (data) {\n                    transaction(tx => {\n                        item.setViewState(data, tx);\n                    });\n                }\n                map.set(d, item);\n                return item;\n            });\n            return { items, getItem: d => map.get(d) };\n        });\n        this._viewItems = this._viewItemsInfo.map(this, items => items.items);\n        this._spaceBetweenPx = 0;\n        this._totalHeight = this._viewItems.map(this, (items, reader) => items.reduce((r, i) => r + i.contentHeight.read(reader) + this._spaceBetweenPx, 0));\n        this._contextKeyService = this._register(this._parentContextKeyService.createScoped(this._element));\n        this._instantiationService = this._register(this._parentInstantiationService.createChild(new ServiceCollection([IContextKeyService, this._contextKeyService])));\n        /** This accounts for documents that are not loaded yet. */\n        this._lastDocStates = {};\n        this._contextKeyService.createKey(EditorContextKeys.inMultiDiffEditor.key, true);\n        this._register(autorunWithStore((reader, store) => {\n            const viewModel = this._viewModel.read(reader);\n            if (viewModel && viewModel.contextKeys) {\n                for (const [key, value] of Object.entries(viewModel.contextKeys)) {\n                    const contextKey = this._contextKeyService.createKey(key, undefined);\n                    contextKey.set(value);\n                    store.add(toDisposable(() => contextKey.reset()));\n                }\n            }\n        }));\n        const ctxAllCollapsed = this._parentContextKeyService.createKey(EditorContextKeys.multiDiffEditorAllCollapsed.key, false);\n        this._register(autorun((reader) => {\n            const viewModel = this._viewModel.read(reader);\n            if (viewModel) {\n                const allCollapsed = viewModel.items.read(reader).every(item => item.collapsed.read(reader));\n                ctxAllCollapsed.set(allCollapsed);\n            }\n        }));\n        this._register(autorun((reader) => {\n            /** @description Update widget dimension */\n            const dimension = this._dimension.read(reader);\n            this._sizeObserver.observe(dimension);\n        }));\n        this._register(autorun((reader) => {\n            /** @description Update widget dimension */\n            const items = this._viewItems.read(reader);\n            this._elements.placeholder.classList.toggle('visible', items.length === 0);\n        }));\n        this._scrollableElements.content.style.position = 'relative';\n        this._register(autorun((reader) => {\n            /** @description Update scroll dimensions */\n            const height = this._sizeObserver.height.read(reader);\n            this._scrollableElements.root.style.height = `${height}px`;\n            const totalHeight = this._totalHeight.read(reader);\n            this._scrollableElements.content.style.height = `${totalHeight}px`;\n            const width = this._sizeObserver.width.read(reader);\n            let scrollWidth = width;\n            const viewItems = this._viewItems.read(reader);\n            const max = findFirstMax(viewItems, compareBy(i => i.maxScroll.read(reader).maxScroll, numberComparator));\n            if (max) {\n                const maxScroll = max.maxScroll.read(reader);\n                scrollWidth = width + maxScroll.maxScroll;\n            }\n            this._scrollableElement.setScrollDimensions({\n                width: width,\n                height: height,\n                scrollHeight: totalHeight,\n                scrollWidth,\n            });\n        }));\n        _element.replaceChildren(this._elements.root);\n        this._register(toDisposable(() => {\n            _element.replaceChildren();\n        }));\n        this._register(this._register(autorun(reader => {\n            /** @description Render all */\n            globalTransaction(tx => {\n                this.render(reader);\n            });\n        })));\n    }\n    render(reader) {\n        const scrollTop = this.scrollTop.read(reader);\n        let contentScrollOffsetToScrollOffset = 0;\n        let itemHeightSumBefore = 0;\n        let itemContentHeightSumBefore = 0;\n        const viewPortHeight = this._sizeObserver.height.read(reader);\n        const contentViewPort = OffsetRange.ofStartAndLength(scrollTop, viewPortHeight);\n        const width = this._sizeObserver.width.read(reader);\n        for (const v of this._viewItems.read(reader)) {\n            const itemContentHeight = v.contentHeight.read(reader);\n            const itemHeight = Math.min(itemContentHeight, viewPortHeight);\n            const itemRange = OffsetRange.ofStartAndLength(itemHeightSumBefore, itemHeight);\n            const itemContentRange = OffsetRange.ofStartAndLength(itemContentHeightSumBefore, itemContentHeight);\n            if (itemContentRange.isBefore(contentViewPort)) {\n                contentScrollOffsetToScrollOffset -= itemContentHeight - itemHeight;\n                v.hide();\n            }\n            else if (itemContentRange.isAfter(contentViewPort)) {\n                v.hide();\n            }\n            else {\n                const scroll = Math.max(0, Math.min(contentViewPort.start - itemContentRange.start, itemContentHeight - itemHeight));\n                contentScrollOffsetToScrollOffset -= scroll;\n                const viewPort = OffsetRange.ofStartAndLength(scrollTop + contentScrollOffsetToScrollOffset, viewPortHeight);\n                v.render(itemRange, scroll, width, viewPort);\n            }\n            itemHeightSumBefore += itemHeight + this._spaceBetweenPx;\n            itemContentHeightSumBefore += itemContentHeight + this._spaceBetweenPx;\n        }\n        this._scrollableElements.content.style.transform = `translateY(${-(scrollTop + contentScrollOffsetToScrollOffset)}px)`;\n    }\n};\nMultiDiffEditorWidgetImpl = __decorate([\n    __param(4, IContextKeyService),\n    __param(5, IInstantiationService)\n], MultiDiffEditorWidgetImpl);\nexport { MultiDiffEditorWidgetImpl };\nclass VirtualizedViewItem extends Disposable {\n    constructor(viewModel, _objectPool, _scrollLeft, _deltaScrollVertical) {\n        super();\n        this.viewModel = viewModel;\n        this._objectPool = _objectPool;\n        this._scrollLeft = _scrollLeft;\n        this._deltaScrollVertical = _deltaScrollVertical;\n        this._templateRef = this._register(disposableObservableValue(this, undefined));\n        this.contentHeight = derived(this, reader => { var _a, _b, _c; return (_c = (_b = (_a = this._templateRef.read(reader)) === null || _a === void 0 ? void 0 : _a.object.contentHeight) === null || _b === void 0 ? void 0 : _b.read(reader)) !== null && _c !== void 0 ? _c : this.viewModel.lastTemplateData.read(reader).contentHeight; });\n        this.maxScroll = derived(this, reader => { var _a, _b; return (_b = (_a = this._templateRef.read(reader)) === null || _a === void 0 ? void 0 : _a.object.maxScroll.read(reader)) !== null && _b !== void 0 ? _b : { maxScroll: 0, scrollWidth: 0 }; });\n        this.template = derived(this, reader => { var _a; return (_a = this._templateRef.read(reader)) === null || _a === void 0 ? void 0 : _a.object; });\n        this._isHidden = observableValue(this, false);\n        this._isFocused = derived(this, reader => { var _a, _b; return (_b = (_a = this.template.read(reader)) === null || _a === void 0 ? void 0 : _a.isFocused.read(reader)) !== null && _b !== void 0 ? _b : false; });\n        this.viewModel.setIsFocused(this._isFocused, undefined);\n        this._register(autorun((reader) => {\n            var _a;\n            const scrollLeft = this._scrollLeft.read(reader);\n            (_a = this._templateRef.read(reader)) === null || _a === void 0 ? void 0 : _a.object.setScrollLeft(scrollLeft);\n        }));\n        this._register(autorun(reader => {\n            const ref = this._templateRef.read(reader);\n            if (!ref) {\n                return;\n            }\n            const isHidden = this._isHidden.read(reader);\n            if (!isHidden) {\n                return;\n            }\n            const isFocused = ref.object.isFocused.read(reader);\n            if (isFocused) {\n                return;\n            }\n            this._clear();\n        }));\n    }\n    dispose() {\n        this._clear();\n        super.dispose();\n    }\n    toString() {\n        var _a;\n        return `VirtualViewItem(${(_a = this.viewModel.entry.value.modified) === null || _a === void 0 ? void 0 : _a.uri.toString()})`;\n    }\n    getKey() {\n        return this.viewModel.getKey();\n    }\n    setViewState(viewState, tx) {\n        var _a;\n        this.viewModel.collapsed.set(viewState.collapsed, tx);\n        this._updateTemplateData(tx);\n        const data = this.viewModel.lastTemplateData.get();\n        const selections = (_a = viewState.selections) === null || _a === void 0 ? void 0 : _a.map(Selection.liftSelection);\n        this.viewModel.lastTemplateData.set({\n            ...data,\n            selections,\n        }, tx);\n        const ref = this._templateRef.get();\n        if (ref) {\n            if (selections) {\n                ref.object.editor.setSelections(selections);\n            }\n        }\n    }\n    _updateTemplateData(tx) {\n        var _a;\n        const ref = this._templateRef.get();\n        if (!ref) {\n            return;\n        }\n        this.viewModel.lastTemplateData.set({\n            contentHeight: ref.object.contentHeight.get(),\n            selections: (_a = ref.object.editor.getSelections()) !== null && _a !== void 0 ? _a : undefined,\n        }, tx);\n    }\n    _clear() {\n        const ref = this._templateRef.get();\n        if (!ref) {\n            return;\n        }\n        transaction(tx => {\n            this._updateTemplateData(tx);\n            ref.object.hide();\n            this._templateRef.set(undefined, tx);\n        });\n    }\n    hide() {\n        this._isHidden.set(true, undefined);\n    }\n    render(verticalSpace, offset, width, viewPort) {\n        this._isHidden.set(false, undefined);\n        let ref = this._templateRef.get();\n        if (!ref) {\n            ref = this._objectPool.getUnusedObj(new TemplateData(this.viewModel, this._deltaScrollVertical));\n            this._templateRef.set(ref, undefined);\n            const selections = this.viewModel.lastTemplateData.get().selections;\n            if (selections) {\n                ref.object.editor.setSelections(selections);\n            }\n        }\n        ref.object.render(verticalSpace, width, offset, viewPort);\n    }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}