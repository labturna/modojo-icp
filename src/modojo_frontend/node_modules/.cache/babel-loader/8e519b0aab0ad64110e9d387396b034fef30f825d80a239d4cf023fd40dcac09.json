{"ast":null,"code":"/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nvar __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n    r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n    d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nvar __param = this && this.__param || function (paramIndex, decorator) {\n  return function (target, key) {\n    decorator(target, key, paramIndex);\n  };\n};\nvar WordHighlighter_1, WordHighlighterContribution_1;\nimport * as nls from '../../../../nls.js';\nimport * as arrays from '../../../../base/common/arrays.js';\nimport { alert } from '../../../../base/browser/ui/aria/aria.js';\nimport { createCancelablePromise, first, timeout } from '../../../../base/common/async.js';\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport { onUnexpectedError, onUnexpectedExternalError } from '../../../../base/common/errors.js';\nimport { Disposable, DisposableStore } from '../../../../base/common/lifecycle.js';\nimport { isDiffEditor } from '../../../browser/editorBrowser.js';\nimport { EditorAction, registerEditorAction, registerEditorContribution, registerModelAndPositionCommand } from '../../../browser/editorExtensions.js';\nimport { ICodeEditorService } from '../../../browser/services/codeEditorService.js';\nimport { Range } from '../../../common/core/range.js';\nimport { EditorContextKeys } from '../../../common/editorContextKeys.js';\nimport { DocumentHighlightKind } from '../../../common/languages.js';\nimport { shouldSynchronizeModel } from '../../../common/model.js';\nimport { ILanguageFeaturesService } from '../../../common/services/languageFeatures.js';\nimport { getHighlightDecorationOptions } from './highlightDecorations.js';\nimport { IContextKeyService, RawContextKey } from '../../../../platform/contextkey/common/contextkey.js';\nimport { Schemas } from '../../../../base/common/network.js';\nimport { ResourceMap } from '../../../../base/common/map.js';\nimport { score } from '../../../common/languageSelector.js';\n// import { TextualMultiDocumentHighlightFeature } from 'vs/editor/contrib/wordHighlighter/browser/textualHighlightProvider';\n// import { registerEditorFeature } from 'vs/editor/common/editorFeatures';\nconst ctxHasWordHighlights = new RawContextKey('hasWordHighlights', false);\nexport function getOccurrencesAtPosition(registry, model, position, token) {\n  const orderedByScore = registry.ordered(model);\n  // in order of score ask the occurrences provider\n  // until someone response with a good result\n  // (good = none empty array)\n  return first(orderedByScore.map(provider => () => {\n    return Promise.resolve(provider.provideDocumentHighlights(model, position, token)).then(undefined, onUnexpectedExternalError);\n  }), arrays.isNonEmptyArray).then(result => {\n    if (result) {\n      const map = new ResourceMap();\n      map.set(model.uri, result);\n      return map;\n    }\n    return new ResourceMap();\n  });\n}\nexport function getOccurrencesAcrossMultipleModels(registry, model, position, wordSeparators, token, otherModels) {\n  const orderedByScore = registry.ordered(model);\n  // in order of score ask the occurrences provider\n  // until someone response with a good result\n  // (good = none empty array)\n  return first(orderedByScore.map(provider => () => {\n    const filteredModels = otherModels.filter(otherModel => {\n      return shouldSynchronizeModel(otherModel);\n    }).filter(otherModel => {\n      return score(provider.selector, otherModel.uri, otherModel.getLanguageId(), true, undefined, undefined) > 0;\n    });\n    return Promise.resolve(provider.provideMultiDocumentHighlights(model, position, filteredModels, token)).then(undefined, onUnexpectedExternalError);\n  }), t => t instanceof ResourceMap && t.size > 0);\n}\nclass OccurenceAtPositionRequest {\n  constructor(_model, _selection, _wordSeparators) {\n    this._model = _model;\n    this._selection = _selection;\n    this._wordSeparators = _wordSeparators;\n    this._wordRange = this._getCurrentWordRange(_model, _selection);\n    this._result = null;\n  }\n  get result() {\n    if (!this._result) {\n      this._result = createCancelablePromise(token => this._compute(this._model, this._selection, this._wordSeparators, token));\n    }\n    return this._result;\n  }\n  _getCurrentWordRange(model, selection) {\n    const word = model.getWordAtPosition(selection.getPosition());\n    if (word) {\n      return new Range(selection.startLineNumber, word.startColumn, selection.startLineNumber, word.endColumn);\n    }\n    return null;\n  }\n  isValid(model, selection, decorations) {\n    const lineNumber = selection.startLineNumber;\n    const startColumn = selection.startColumn;\n    const endColumn = selection.endColumn;\n    const currentWordRange = this._getCurrentWordRange(model, selection);\n    let requestIsValid = Boolean(this._wordRange && this._wordRange.equalsRange(currentWordRange));\n    // Even if we are on a different word, if that word is in the decorations ranges, the request is still valid\n    // (Same symbol)\n    for (let i = 0, len = decorations.length; !requestIsValid && i < len; i++) {\n      const range = decorations.getRange(i);\n      if (range && range.startLineNumber === lineNumber) {\n        if (range.startColumn <= startColumn && range.endColumn >= endColumn) {\n          requestIsValid = true;\n        }\n      }\n    }\n    return requestIsValid;\n  }\n  cancel() {\n    this.result.cancel();\n  }\n}\nclass SemanticOccurenceAtPositionRequest extends OccurenceAtPositionRequest {\n  constructor(model, selection, wordSeparators, providers) {\n    super(model, selection, wordSeparators);\n    this._providers = providers;\n  }\n  _compute(model, selection, wordSeparators, token) {\n    return getOccurrencesAtPosition(this._providers, model, selection.getPosition(), token).then(value => {\n      if (!value) {\n        return new ResourceMap();\n      }\n      return value;\n    });\n  }\n}\nclass MultiModelOccurenceRequest extends OccurenceAtPositionRequest {\n  constructor(model, selection, wordSeparators, providers, otherModels) {\n    super(model, selection, wordSeparators);\n    this._providers = providers;\n    this._otherModels = otherModels;\n  }\n  _compute(model, selection, wordSeparators, token) {\n    return getOccurrencesAcrossMultipleModels(this._providers, model, selection.getPosition(), wordSeparators, token, this._otherModels).then(value => {\n      if (!value) {\n        return new ResourceMap();\n      }\n      return value;\n    });\n  }\n}\nclass TextualOccurenceRequest extends OccurenceAtPositionRequest {\n  constructor(model, selection, word, wordSeparators, otherModels) {\n    super(model, selection, wordSeparators);\n    this._otherModels = otherModels;\n    this._selectionIsEmpty = selection.isEmpty();\n    this._word = word;\n  }\n  _compute(model, selection, wordSeparators, token) {\n    return timeout(250, token).then(() => {\n      const result = new ResourceMap();\n      let wordResult;\n      if (this._word) {\n        wordResult = this._word;\n      } else {\n        wordResult = model.getWordAtPosition(selection.getPosition());\n      }\n      if (!wordResult) {\n        return new ResourceMap();\n      }\n      const allModels = [model, ...this._otherModels];\n      for (const otherModel of allModels) {\n        if (otherModel.isDisposed()) {\n          continue;\n        }\n        const matches = otherModel.findMatches(wordResult.word, true, false, true, wordSeparators, false);\n        const highlights = matches.map(m => ({\n          range: m.range,\n          kind: DocumentHighlightKind.Text\n        }));\n        if (highlights) {\n          result.set(otherModel.uri, highlights);\n        }\n      }\n      return result;\n    });\n  }\n  isValid(model, selection, decorations) {\n    const currentSelectionIsEmpty = selection.isEmpty();\n    if (this._selectionIsEmpty !== currentSelectionIsEmpty) {\n      return false;\n    }\n    return super.isValid(model, selection, decorations);\n  }\n}\nfunction computeOccurencesAtPosition(registry, model, selection, word, wordSeparators) {\n  if (registry.has(model)) {\n    return new SemanticOccurenceAtPositionRequest(model, selection, wordSeparators, registry);\n  }\n  return new TextualOccurenceRequest(model, selection, word, wordSeparators, []);\n}\nfunction computeOccurencesMultiModel(registry, model, selection, word, wordSeparators, otherModels) {\n  if (registry.has(model)) {\n    return new MultiModelOccurenceRequest(model, selection, wordSeparators, registry, otherModels);\n  }\n  return new TextualOccurenceRequest(model, selection, word, wordSeparators, otherModels);\n}\nregisterModelAndPositionCommand('_executeDocumentHighlights', async (accessor, model, position) => {\n  const languageFeaturesService = accessor.get(ILanguageFeaturesService);\n  const map = await getOccurrencesAtPosition(languageFeaturesService.documentHighlightProvider, model, position, CancellationToken.None);\n  return map === null || map === void 0 ? void 0 : map.get(model.uri);\n});\nlet WordHighlighter = WordHighlighter_1 = class WordHighlighter {\n  constructor(editor, providers, multiProviders, contextKeyService, codeEditorService) {\n    this.toUnhook = new DisposableStore();\n    this.workerRequestTokenId = 0;\n    this.workerRequestCompleted = false;\n    this.workerRequestValue = new ResourceMap();\n    this.lastCursorPositionChangeTime = 0;\n    this.renderDecorationsTimer = -1;\n    this.editor = editor;\n    this.providers = providers;\n    this.multiDocumentProviders = multiProviders;\n    this.codeEditorService = codeEditorService;\n    this._hasWordHighlights = ctxHasWordHighlights.bindTo(contextKeyService);\n    this._ignorePositionChangeEvent = false;\n    this.occurrencesHighlight = this.editor.getOption(81 /* EditorOption.occurrencesHighlight */);\n    this.model = this.editor.getModel();\n    this.toUnhook.add(editor.onDidChangeCursorPosition(e => {\n      if (this._ignorePositionChangeEvent) {\n        // We are changing the position => ignore this event\n        return;\n      }\n      if (this.occurrencesHighlight === 'off') {\n        // Early exit if nothing needs to be done!\n        // Leave some form of early exit check here if you wish to continue being a cursor position change listener ;)\n        return;\n      }\n      this._onPositionChanged(e);\n    }));\n    this.toUnhook.add(editor.onDidFocusEditorText(e => {\n      if (this.occurrencesHighlight === 'off') {\n        // Early exit if nothing needs to be done\n        return;\n      }\n      if (!this.workerRequest) {\n        this._run();\n      }\n    }));\n    this.toUnhook.add(editor.onDidChangeModelContent(e => {\n      this._stopAll();\n    }));\n    this.toUnhook.add(editor.onDidChangeModel(e => {\n      if (!e.newModelUrl && e.oldModelUrl) {\n        this._stopSingular();\n      } else {\n        if (WordHighlighter_1.query) {\n          this._run();\n        }\n      }\n    }));\n    this.toUnhook.add(editor.onDidChangeConfiguration(e => {\n      const newValue = this.editor.getOption(81 /* EditorOption.occurrencesHighlight */);\n      if (this.occurrencesHighlight !== newValue) {\n        this.occurrencesHighlight = newValue;\n        this._stopAll();\n      }\n    }));\n    this.decorations = this.editor.createDecorationsCollection();\n    this.workerRequestTokenId = 0;\n    this.workerRequest = null;\n    this.workerRequestCompleted = false;\n    this.lastCursorPositionChangeTime = 0;\n    this.renderDecorationsTimer = -1;\n    // if there is a query already, highlight off that query\n    if (WordHighlighter_1.query) {\n      this._run();\n    }\n  }\n  hasDecorations() {\n    return this.decorations.length > 0;\n  }\n  restore() {\n    if (this.occurrencesHighlight === 'off') {\n      return;\n    }\n    this._run();\n  }\n  _getSortedHighlights() {\n    return this.decorations.getRanges().sort(Range.compareRangesUsingStarts);\n  }\n  moveNext() {\n    const highlights = this._getSortedHighlights();\n    const index = highlights.findIndex(range => range.containsPosition(this.editor.getPosition()));\n    const newIndex = (index + 1) % highlights.length;\n    const dest = highlights[newIndex];\n    try {\n      this._ignorePositionChangeEvent = true;\n      this.editor.setPosition(dest.getStartPosition());\n      this.editor.revealRangeInCenterIfOutsideViewport(dest);\n      const word = this._getWord();\n      if (word) {\n        const lineContent = this.editor.getModel().getLineContent(dest.startLineNumber);\n        alert(`${lineContent}, ${newIndex + 1} of ${highlights.length} for '${word.word}'`);\n      }\n    } finally {\n      this._ignorePositionChangeEvent = false;\n    }\n  }\n  moveBack() {\n    const highlights = this._getSortedHighlights();\n    const index = highlights.findIndex(range => range.containsPosition(this.editor.getPosition()));\n    const newIndex = (index - 1 + highlights.length) % highlights.length;\n    const dest = highlights[newIndex];\n    try {\n      this._ignorePositionChangeEvent = true;\n      this.editor.setPosition(dest.getStartPosition());\n      this.editor.revealRangeInCenterIfOutsideViewport(dest);\n      const word = this._getWord();\n      if (word) {\n        const lineContent = this.editor.getModel().getLineContent(dest.startLineNumber);\n        alert(`${lineContent}, ${newIndex + 1} of ${highlights.length} for '${word.word}'`);\n      }\n    } finally {\n      this._ignorePositionChangeEvent = false;\n    }\n  }\n  _removeSingleDecorations() {\n    // return if no model\n    if (!this.editor.hasModel()) {\n      return;\n    }\n    const currentDecorationIDs = WordHighlighter_1.storedDecorations.get(this.editor.getModel().uri);\n    if (!currentDecorationIDs) {\n      return;\n    }\n    this.editor.removeDecorations(currentDecorationIDs);\n    WordHighlighter_1.storedDecorations.delete(this.editor.getModel().uri);\n    if (this.decorations.length > 0) {\n      this.decorations.clear();\n      this._hasWordHighlights.set(false);\n    }\n  }\n  _removeAllDecorations() {\n    const currentEditors = this.codeEditorService.listCodeEditors();\n    const deleteURI = [];\n    // iterate over editors and store models in currentModels\n    for (const editor of currentEditors) {\n      if (!editor.hasModel()) {\n        continue;\n      }\n      const currentDecorationIDs = WordHighlighter_1.storedDecorations.get(editor.getModel().uri);\n      if (!currentDecorationIDs) {\n        continue;\n      }\n      editor.removeDecorations(currentDecorationIDs);\n      deleteURI.push(editor.getModel().uri);\n      const editorHighlighterContrib = WordHighlighterContribution.get(editor);\n      if (!(editorHighlighterContrib === null || editorHighlighterContrib === void 0 ? void 0 : editorHighlighterContrib.wordHighlighter)) {\n        continue;\n      }\n      if (editorHighlighterContrib.wordHighlighter.decorations.length > 0) {\n        editorHighlighterContrib.wordHighlighter.decorations.clear();\n        editorHighlighterContrib.wordHighlighter.workerRequest = null;\n        editorHighlighterContrib.wordHighlighter._hasWordHighlights.set(false);\n      }\n    }\n    for (const uri of deleteURI) {\n      WordHighlighter_1.storedDecorations.delete(uri);\n    }\n  }\n  _stopSingular() {\n    var _a, _b, _c, _d;\n    // Remove any existing decorations + a possible query, and re - run to update decorations\n    this._removeSingleDecorations();\n    if (this.editor.hasTextFocus()) {\n      if (((_a = this.editor.getModel()) === null || _a === void 0 ? void 0 : _a.uri.scheme) !== Schemas.vscodeNotebookCell && ((_c = (_b = WordHighlighter_1.query) === null || _b === void 0 ? void 0 : _b.modelInfo) === null || _c === void 0 ? void 0 : _c.model.uri.scheme) !== Schemas.vscodeNotebookCell) {\n        // clear query if focused non-nb editor\n        WordHighlighter_1.query = null;\n        this._run(); // TODO: @Yoyokrazy -- investigate why we need a full rerun here. likely addressed a case/patch in the first iteration of this feature\n      } else {\n        // remove modelInfo to account for nb cell being disposed\n        if ((_d = WordHighlighter_1.query) === null || _d === void 0 ? void 0 : _d.modelInfo) {\n          WordHighlighter_1.query.modelInfo = null;\n        }\n      }\n    }\n    // Cancel any renderDecorationsTimer\n    if (this.renderDecorationsTimer !== -1) {\n      clearTimeout(this.renderDecorationsTimer);\n      this.renderDecorationsTimer = -1;\n    }\n    // Cancel any worker request\n    if (this.workerRequest !== null) {\n      this.workerRequest.cancel();\n      this.workerRequest = null;\n    }\n    // Invalidate any worker request callback\n    if (!this.workerRequestCompleted) {\n      this.workerRequestTokenId++;\n      this.workerRequestCompleted = true;\n    }\n  }\n  _stopAll() {\n    // Remove any existing decorations\n    // TODO: @Yoyokrazy -- this triggers as notebooks scroll, causing highlights to disappear momentarily.\n    // maybe a nb type check?\n    this._removeAllDecorations();\n    // Cancel any renderDecorationsTimer\n    if (this.renderDecorationsTimer !== -1) {\n      clearTimeout(this.renderDecorationsTimer);\n      this.renderDecorationsTimer = -1;\n    }\n    // Cancel any worker request\n    if (this.workerRequest !== null) {\n      this.workerRequest.cancel();\n      this.workerRequest = null;\n    }\n    // Invalidate any worker request callback\n    if (!this.workerRequestCompleted) {\n      this.workerRequestTokenId++;\n      this.workerRequestCompleted = true;\n    }\n  }\n  _onPositionChanged(e) {\n    var _a;\n    // disabled\n    if (this.occurrencesHighlight === 'off') {\n      this._stopAll();\n      return;\n    }\n    // ignore typing & other\n    // need to check if the model is a notebook cell, should not stop if nb\n    if (e.reason !== 3 /* CursorChangeReason.Explicit */ && ((_a = this.editor.getModel()) === null || _a === void 0 ? void 0 : _a.uri.scheme) !== Schemas.vscodeNotebookCell) {\n      this._stopAll();\n      return;\n    }\n    this._run();\n  }\n  _getWord() {\n    const editorSelection = this.editor.getSelection();\n    const lineNumber = editorSelection.startLineNumber;\n    const startColumn = editorSelection.startColumn;\n    if (this.model.isDisposed()) {\n      return null;\n    }\n    return this.model.getWordAtPosition({\n      lineNumber: lineNumber,\n      column: startColumn\n    });\n  }\n  getOtherModelsToHighlight(model) {\n    if (!model) {\n      return [];\n    }\n    // notebook case\n    const isNotebookEditor = model.uri.scheme === Schemas.vscodeNotebookCell;\n    if (isNotebookEditor) {\n      const currentModels = [];\n      const currentEditors = this.codeEditorService.listCodeEditors();\n      for (const editor of currentEditors) {\n        const tempModel = editor.getModel();\n        if (tempModel && tempModel !== model && tempModel.uri.scheme === Schemas.vscodeNotebookCell) {\n          currentModels.push(tempModel);\n        }\n      }\n      return currentModels;\n    }\n    // inline case\n    // ? current works when highlighting outside of an inline diff, highlighting in.\n    // ? broken when highlighting within a diff editor. highlighting the main editor does not work\n    // ? editor group service could be useful here\n    const currentModels = [];\n    const currentEditors = this.codeEditorService.listCodeEditors();\n    for (const editor of currentEditors) {\n      if (!isDiffEditor(editor)) {\n        continue;\n      }\n      const diffModel = editor.getModel();\n      if (!diffModel) {\n        continue;\n      }\n      if (model === diffModel.modified) {\n        // embedded inline chat diff would pass this, allowing highlights\n        //? currentModels.push(diffModel.original);\n        currentModels.push(diffModel.modified);\n      }\n    }\n    if (currentModels.length) {\n      // no matching editors have been found\n      return currentModels;\n    }\n    // multi-doc OFF\n    if (this.occurrencesHighlight === 'singleFile') {\n      return [];\n    }\n    // multi-doc ON\n    for (const editor of currentEditors) {\n      const tempModel = editor.getModel();\n      const isValidModel = tempModel && tempModel !== model;\n      if (isValidModel) {\n        currentModels.push(tempModel);\n      }\n    }\n    return currentModels;\n  }\n  _run() {\n    var _a;\n    let workerRequestIsValid;\n    const hasTextFocus = this.editor.hasTextFocus();\n    if (!hasTextFocus) {\n      // new nb cell scrolled in, didChangeModel fires\n      if (!WordHighlighter_1.query) {\n        // no previous query, nothing to highlight off of\n        return;\n      }\n    } else {\n      // has text focus\n      const editorSelection = this.editor.getSelection();\n      // ignore multiline selection\n      if (!editorSelection || editorSelection.startLineNumber !== editorSelection.endLineNumber) {\n        WordHighlighter_1.query = null;\n        this._stopAll();\n        return;\n      }\n      const startColumn = editorSelection.startColumn;\n      const endColumn = editorSelection.endColumn;\n      const word = this._getWord();\n      // The selection must be inside a word or surround one word at most\n      if (!word || word.startColumn > startColumn || word.endColumn < endColumn) {\n        // no previous query, nothing to highlight\n        WordHighlighter_1.query = null;\n        this._stopAll();\n        return;\n      }\n      // All the effort below is trying to achieve this:\n      // - when cursor is moved to a word, trigger immediately a findOccurrences request\n      // - 250ms later after the last cursor move event, render the occurrences\n      // - no flickering!\n      workerRequestIsValid = this.workerRequest && this.workerRequest.isValid(this.model, editorSelection, this.decorations);\n      WordHighlighter_1.query = {\n        modelInfo: {\n          model: this.model,\n          selection: editorSelection\n        },\n        word: word\n      };\n    }\n    // There are 4 cases:\n    // a) old workerRequest is valid & completed, renderDecorationsTimer fired\n    // b) old workerRequest is valid & completed, renderDecorationsTimer not fired\n    // c) old workerRequest is valid, but not completed\n    // d) old workerRequest is not valid\n    // For a) no action is needed\n    // For c), member 'lastCursorPositionChangeTime' will be used when installing the timer so no action is needed\n    this.lastCursorPositionChangeTime = new Date().getTime();\n    if (workerRequestIsValid) {\n      if (this.workerRequestCompleted && this.renderDecorationsTimer !== -1) {\n        // case b)\n        // Delay the firing of renderDecorationsTimer by an extra 250 ms\n        clearTimeout(this.renderDecorationsTimer);\n        this.renderDecorationsTimer = -1;\n        this._beginRenderDecorations();\n      }\n    } else {\n      // case d)\n      // Stop all previous actions and start fresh\n      this._stopAll();\n      const myRequestId = ++this.workerRequestTokenId;\n      this.workerRequestCompleted = false;\n      const otherModelsToHighlight = this.getOtherModelsToHighlight(this.editor.getModel());\n      // when reaching here, there are two possible states.\n      // \t\t1) we have text focus, and a valid query was updated.\n      // \t\t2) we do not have text focus, and a valid query is cached.\n      // the query will ALWAYS have the correct data for the current highlight request, so it can always be passed to the workerRequest safely\n      if (!WordHighlighter_1.query.modelInfo || WordHighlighter_1.query.modelInfo.model.isDisposed()) {\n        return;\n      }\n      this.workerRequest = this.computeWithModel(WordHighlighter_1.query.modelInfo.model, WordHighlighter_1.query.modelInfo.selection, WordHighlighter_1.query.word, otherModelsToHighlight);\n      (_a = this.workerRequest) === null || _a === void 0 ? void 0 : _a.result.then(data => {\n        if (myRequestId === this.workerRequestTokenId) {\n          this.workerRequestCompleted = true;\n          this.workerRequestValue = data || [];\n          this._beginRenderDecorations();\n        }\n      }, onUnexpectedError);\n    }\n  }\n  computeWithModel(model, selection, word, otherModels) {\n    if (!otherModels.length) {\n      return computeOccurencesAtPosition(this.providers, model, selection, word, this.editor.getOption(131 /* EditorOption.wordSeparators */));\n    } else {\n      return computeOccurencesMultiModel(this.multiDocumentProviders, model, selection, word, this.editor.getOption(131 /* EditorOption.wordSeparators */), otherModels);\n    }\n  }\n  _beginRenderDecorations() {\n    const currentTime = new Date().getTime();\n    const minimumRenderTime = this.lastCursorPositionChangeTime + 250;\n    if (currentTime >= minimumRenderTime) {\n      // Synchronous\n      this.renderDecorationsTimer = -1;\n      this.renderDecorations();\n    } else {\n      // Asynchronous\n      this.renderDecorationsTimer = setTimeout(() => {\n        this.renderDecorations();\n      }, minimumRenderTime - currentTime);\n    }\n  }\n  renderDecorations() {\n    var _a, _b, _c;\n    this.renderDecorationsTimer = -1;\n    // create new loop, iterate over current editors using this.codeEditorService.listCodeEditors(),\n    // if the URI of that codeEditor is in the map, then add the decorations to the decorations array\n    // then set the decorations for the editor\n    const currentEditors = this.codeEditorService.listCodeEditors();\n    for (const editor of currentEditors) {\n      const editorHighlighterContrib = WordHighlighterContribution.get(editor);\n      if (!editorHighlighterContrib) {\n        continue;\n      }\n      const newDecorations = [];\n      const uri = (_a = editor.getModel()) === null || _a === void 0 ? void 0 : _a.uri;\n      if (uri && this.workerRequestValue.has(uri)) {\n        const oldDecorationIDs = WordHighlighter_1.storedDecorations.get(uri);\n        const newDocumentHighlights = this.workerRequestValue.get(uri);\n        if (newDocumentHighlights) {\n          for (const highlight of newDocumentHighlights) {\n            if (!highlight.range) {\n              continue;\n            }\n            newDecorations.push({\n              range: highlight.range,\n              options: getHighlightDecorationOptions(highlight.kind)\n            });\n          }\n        }\n        let newDecorationIDs = [];\n        editor.changeDecorations(changeAccessor => {\n          newDecorationIDs = changeAccessor.deltaDecorations(oldDecorationIDs !== null && oldDecorationIDs !== void 0 ? oldDecorationIDs : [], newDecorations);\n        });\n        WordHighlighter_1.storedDecorations = WordHighlighter_1.storedDecorations.set(uri, newDecorationIDs);\n        if (newDecorations.length > 0) {\n          (_b = editorHighlighterContrib.wordHighlighter) === null || _b === void 0 ? void 0 : _b.decorations.set(newDecorations);\n          (_c = editorHighlighterContrib.wordHighlighter) === null || _c === void 0 ? void 0 : _c._hasWordHighlights.set(true);\n        }\n      }\n    }\n  }\n  dispose() {\n    this._stopSingular();\n    this.toUnhook.dispose();\n  }\n};\nWordHighlighter.storedDecorations = new ResourceMap();\nWordHighlighter.query = null;\nWordHighlighter = WordHighlighter_1 = __decorate([__param(4, ICodeEditorService)], WordHighlighter);\nlet WordHighlighterContribution = WordHighlighterContribution_1 = class WordHighlighterContribution extends Disposable {\n  static get(editor) {\n    return editor.getContribution(WordHighlighterContribution_1.ID);\n  }\n  constructor(editor, contextKeyService, languageFeaturesService, codeEditorService) {\n    super();\n    this._wordHighlighter = null;\n    const createWordHighlighterIfPossible = () => {\n      if (editor.hasModel() && !editor.getModel().isTooLargeForTokenization()) {\n        this._wordHighlighter = new WordHighlighter(editor, languageFeaturesService.documentHighlightProvider, languageFeaturesService.multiDocumentHighlightProvider, contextKeyService, codeEditorService);\n      }\n    };\n    this._register(editor.onDidChangeModel(e => {\n      if (this._wordHighlighter) {\n        this._wordHighlighter.dispose();\n        this._wordHighlighter = null;\n      }\n      createWordHighlighterIfPossible();\n    }));\n    createWordHighlighterIfPossible();\n  }\n  get wordHighlighter() {\n    return this._wordHighlighter;\n  }\n  saveViewState() {\n    if (this._wordHighlighter && this._wordHighlighter.hasDecorations()) {\n      return true;\n    }\n    return false;\n  }\n  moveNext() {\n    var _a;\n    (_a = this._wordHighlighter) === null || _a === void 0 ? void 0 : _a.moveNext();\n  }\n  moveBack() {\n    var _a;\n    (_a = this._wordHighlighter) === null || _a === void 0 ? void 0 : _a.moveBack();\n  }\n  restoreViewState(state) {\n    if (this._wordHighlighter && state) {\n      this._wordHighlighter.restore();\n    }\n  }\n  dispose() {\n    if (this._wordHighlighter) {\n      this._wordHighlighter.dispose();\n      this._wordHighlighter = null;\n    }\n    super.dispose();\n  }\n};\nWordHighlighterContribution.ID = 'editor.contrib.wordHighlighter';\nWordHighlighterContribution = WordHighlighterContribution_1 = __decorate([__param(1, IContextKeyService), __param(2, ILanguageFeaturesService), __param(3, ICodeEditorService)], WordHighlighterContribution);\nexport { WordHighlighterContribution };\nclass WordHighlightNavigationAction extends EditorAction {\n  constructor(next, opts) {\n    super(opts);\n    this._isNext = next;\n  }\n  run(accessor, editor) {\n    const controller = WordHighlighterContribution.get(editor);\n    if (!controller) {\n      return;\n    }\n    if (this._isNext) {\n      controller.moveNext();\n    } else {\n      controller.moveBack();\n    }\n  }\n}\nclass NextWordHighlightAction extends WordHighlightNavigationAction {\n  constructor() {\n    super(true, {\n      id: 'editor.action.wordHighlight.next',\n      label: nls.localize('wordHighlight.next.label', \"Go to Next Symbol Highlight\"),\n      alias: 'Go to Next Symbol Highlight',\n      precondition: ctxHasWordHighlights,\n      kbOpts: {\n        kbExpr: EditorContextKeys.editorTextFocus,\n        primary: 65 /* KeyCode.F7 */,\n        weight: 100 /* KeybindingWeight.EditorContrib */\n      }\n    });\n  }\n}\nclass PrevWordHighlightAction extends WordHighlightNavigationAction {\n  constructor() {\n    super(false, {\n      id: 'editor.action.wordHighlight.prev',\n      label: nls.localize('wordHighlight.previous.label', \"Go to Previous Symbol Highlight\"),\n      alias: 'Go to Previous Symbol Highlight',\n      precondition: ctxHasWordHighlights,\n      kbOpts: {\n        kbExpr: EditorContextKeys.editorTextFocus,\n        primary: 1024 /* KeyMod.Shift */ | 65 /* KeyCode.F7 */,\n        weight: 100 /* KeybindingWeight.EditorContrib */\n      }\n    });\n  }\n}\nclass TriggerWordHighlightAction extends EditorAction {\n  constructor() {\n    super({\n      id: 'editor.action.wordHighlight.trigger',\n      label: nls.localize('wordHighlight.trigger.label', \"Trigger Symbol Highlight\"),\n      alias: 'Trigger Symbol Highlight',\n      precondition: ctxHasWordHighlights.toNegated(),\n      kbOpts: {\n        kbExpr: EditorContextKeys.editorTextFocus,\n        primary: 0,\n        weight: 100 /* KeybindingWeight.EditorContrib */\n      }\n    });\n  }\n  run(accessor, editor, args) {\n    const controller = WordHighlighterContribution.get(editor);\n    if (!controller) {\n      return;\n    }\n    controller.restoreViewState(true);\n  }\n}\nregisterEditorContribution(WordHighlighterContribution.ID, WordHighlighterContribution, 0 /* EditorContributionInstantiation.Eager */); // eager because it uses `saveViewState`/`restoreViewState`\nregisterEditorAction(NextWordHighlightAction);\nregisterEditorAction(PrevWordHighlightAction);\nregisterEditorAction(TriggerWordHighlightAction);\n// registerEditorFeature(TextualMultiDocumentHighlightFeature);","map":{"version":3,"names":["__decorate","decorators","target","key","desc","c","arguments","length","r","Object","getOwnPropertyDescriptor","d","Reflect","decorate","i","defineProperty","__param","paramIndex","decorator","WordHighlighter_1","WordHighlighterContribution_1","nls","arrays","alert","createCancelablePromise","first","timeout","CancellationToken","onUnexpectedError","onUnexpectedExternalError","Disposable","DisposableStore","isDiffEditor","EditorAction","registerEditorAction","registerEditorContribution","registerModelAndPositionCommand","ICodeEditorService","Range","EditorContextKeys","DocumentHighlightKind","shouldSynchronizeModel","ILanguageFeaturesService","getHighlightDecorationOptions","IContextKeyService","RawContextKey","Schemas","ResourceMap","score","ctxHasWordHighlights","getOccurrencesAtPosition","registry","model","position","token","orderedByScore","ordered","map","provider","Promise","resolve","provideDocumentHighlights","then","undefined","isNonEmptyArray","result","set","uri","getOccurrencesAcrossMultipleModels","wordSeparators","otherModels","filteredModels","filter","otherModel","selector","getLanguageId","provideMultiDocumentHighlights","t","size","OccurenceAtPositionRequest","constructor","_model","_selection","_wordSeparators","_wordRange","_getCurrentWordRange","_result","_compute","selection","word","getWordAtPosition","getPosition","startLineNumber","startColumn","endColumn","isValid","decorations","lineNumber","currentWordRange","requestIsValid","Boolean","equalsRange","len","range","getRange","cancel","SemanticOccurenceAtPositionRequest","providers","_providers","value","MultiModelOccurenceRequest","_otherModels","TextualOccurenceRequest","_selectionIsEmpty","isEmpty","_word","wordResult","allModels","isDisposed","matches","findMatches","highlights","m","kind","Text","currentSelectionIsEmpty","computeOccurencesAtPosition","has","computeOccurencesMultiModel","accessor","languageFeaturesService","get","documentHighlightProvider","None","WordHighlighter","editor","multiProviders","contextKeyService","codeEditorService","toUnhook","workerRequestTokenId","workerRequestCompleted","workerRequestValue","lastCursorPositionChangeTime","renderDecorationsTimer","multiDocumentProviders","_hasWordHighlights","bindTo","_ignorePositionChangeEvent","occurrencesHighlight","getOption","getModel","add","onDidChangeCursorPosition","e","_onPositionChanged","onDidFocusEditorText","workerRequest","_run","onDidChangeModelContent","_stopAll","onDidChangeModel","newModelUrl","oldModelUrl","_stopSingular","query","onDidChangeConfiguration","newValue","createDecorationsCollection","hasDecorations","restore","_getSortedHighlights","getRanges","sort","compareRangesUsingStarts","moveNext","index","findIndex","containsPosition","newIndex","dest","setPosition","getStartPosition","revealRangeInCenterIfOutsideViewport","_getWord","lineContent","getLineContent","moveBack","_removeSingleDecorations","hasModel","currentDecorationIDs","storedDecorations","removeDecorations","delete","clear","_removeAllDecorations","currentEditors","listCodeEditors","deleteURI","push","editorHighlighterContrib","WordHighlighterContribution","wordHighlighter","_a","_b","_c","_d","hasTextFocus","scheme","vscodeNotebookCell","modelInfo","clearTimeout","reason","editorSelection","getSelection","column","getOtherModelsToHighlight","isNotebookEditor","currentModels","tempModel","diffModel","modified","isValidModel","workerRequestIsValid","endLineNumber","Date","getTime","_beginRenderDecorations","myRequestId","otherModelsToHighlight","computeWithModel","data","currentTime","minimumRenderTime","renderDecorations","setTimeout","newDecorations","oldDecorationIDs","newDocumentHighlights","highlight","options","newDecorationIDs","changeDecorations","changeAccessor","deltaDecorations","dispose","getContribution","ID","_wordHighlighter","createWordHighlighterIfPossible","isTooLargeForTokenization","multiDocumentHighlightProvider","_register","saveViewState","restoreViewState","state","WordHighlightNavigationAction","next","opts","_isNext","run","controller","NextWordHighlightAction","id","label","localize","alias","precondition","kbOpts","kbExpr","editorTextFocus","primary","weight","PrevWordHighlightAction","TriggerWordHighlightAction","toNegated","args"],"sources":["/home/arslan/modojo/node_modules/monaco-editor/esm/vs/editor/contrib/wordHighlighter/browser/wordHighlighter.js"],"sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nvar __param = (this && this.__param) || function (paramIndex, decorator) {\n    return function (target, key) { decorator(target, key, paramIndex); }\n};\nvar WordHighlighter_1, WordHighlighterContribution_1;\nimport * as nls from '../../../../nls.js';\nimport * as arrays from '../../../../base/common/arrays.js';\nimport { alert } from '../../../../base/browser/ui/aria/aria.js';\nimport { createCancelablePromise, first, timeout } from '../../../../base/common/async.js';\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport { onUnexpectedError, onUnexpectedExternalError } from '../../../../base/common/errors.js';\nimport { Disposable, DisposableStore } from '../../../../base/common/lifecycle.js';\nimport { isDiffEditor } from '../../../browser/editorBrowser.js';\nimport { EditorAction, registerEditorAction, registerEditorContribution, registerModelAndPositionCommand } from '../../../browser/editorExtensions.js';\nimport { ICodeEditorService } from '../../../browser/services/codeEditorService.js';\nimport { Range } from '../../../common/core/range.js';\nimport { EditorContextKeys } from '../../../common/editorContextKeys.js';\nimport { DocumentHighlightKind } from '../../../common/languages.js';\nimport { shouldSynchronizeModel } from '../../../common/model.js';\nimport { ILanguageFeaturesService } from '../../../common/services/languageFeatures.js';\nimport { getHighlightDecorationOptions } from './highlightDecorations.js';\nimport { IContextKeyService, RawContextKey } from '../../../../platform/contextkey/common/contextkey.js';\nimport { Schemas } from '../../../../base/common/network.js';\nimport { ResourceMap } from '../../../../base/common/map.js';\nimport { score } from '../../../common/languageSelector.js';\n// import { TextualMultiDocumentHighlightFeature } from 'vs/editor/contrib/wordHighlighter/browser/textualHighlightProvider';\n// import { registerEditorFeature } from 'vs/editor/common/editorFeatures';\nconst ctxHasWordHighlights = new RawContextKey('hasWordHighlights', false);\nexport function getOccurrencesAtPosition(registry, model, position, token) {\n    const orderedByScore = registry.ordered(model);\n    // in order of score ask the occurrences provider\n    // until someone response with a good result\n    // (good = none empty array)\n    return first(orderedByScore.map(provider => () => {\n        return Promise.resolve(provider.provideDocumentHighlights(model, position, token))\n            .then(undefined, onUnexpectedExternalError);\n    }), arrays.isNonEmptyArray).then(result => {\n        if (result) {\n            const map = new ResourceMap();\n            map.set(model.uri, result);\n            return map;\n        }\n        return new ResourceMap();\n    });\n}\nexport function getOccurrencesAcrossMultipleModels(registry, model, position, wordSeparators, token, otherModels) {\n    const orderedByScore = registry.ordered(model);\n    // in order of score ask the occurrences provider\n    // until someone response with a good result\n    // (good = none empty array)\n    return first(orderedByScore.map(provider => () => {\n        const filteredModels = otherModels.filter(otherModel => {\n            return shouldSynchronizeModel(otherModel);\n        }).filter(otherModel => {\n            return score(provider.selector, otherModel.uri, otherModel.getLanguageId(), true, undefined, undefined) > 0;\n        });\n        return Promise.resolve(provider.provideMultiDocumentHighlights(model, position, filteredModels, token))\n            .then(undefined, onUnexpectedExternalError);\n    }), (t) => t instanceof ResourceMap && t.size > 0);\n}\nclass OccurenceAtPositionRequest {\n    constructor(_model, _selection, _wordSeparators) {\n        this._model = _model;\n        this._selection = _selection;\n        this._wordSeparators = _wordSeparators;\n        this._wordRange = this._getCurrentWordRange(_model, _selection);\n        this._result = null;\n    }\n    get result() {\n        if (!this._result) {\n            this._result = createCancelablePromise(token => this._compute(this._model, this._selection, this._wordSeparators, token));\n        }\n        return this._result;\n    }\n    _getCurrentWordRange(model, selection) {\n        const word = model.getWordAtPosition(selection.getPosition());\n        if (word) {\n            return new Range(selection.startLineNumber, word.startColumn, selection.startLineNumber, word.endColumn);\n        }\n        return null;\n    }\n    isValid(model, selection, decorations) {\n        const lineNumber = selection.startLineNumber;\n        const startColumn = selection.startColumn;\n        const endColumn = selection.endColumn;\n        const currentWordRange = this._getCurrentWordRange(model, selection);\n        let requestIsValid = Boolean(this._wordRange && this._wordRange.equalsRange(currentWordRange));\n        // Even if we are on a different word, if that word is in the decorations ranges, the request is still valid\n        // (Same symbol)\n        for (let i = 0, len = decorations.length; !requestIsValid && i < len; i++) {\n            const range = decorations.getRange(i);\n            if (range && range.startLineNumber === lineNumber) {\n                if (range.startColumn <= startColumn && range.endColumn >= endColumn) {\n                    requestIsValid = true;\n                }\n            }\n        }\n        return requestIsValid;\n    }\n    cancel() {\n        this.result.cancel();\n    }\n}\nclass SemanticOccurenceAtPositionRequest extends OccurenceAtPositionRequest {\n    constructor(model, selection, wordSeparators, providers) {\n        super(model, selection, wordSeparators);\n        this._providers = providers;\n    }\n    _compute(model, selection, wordSeparators, token) {\n        return getOccurrencesAtPosition(this._providers, model, selection.getPosition(), token).then(value => {\n            if (!value) {\n                return new ResourceMap();\n            }\n            return value;\n        });\n    }\n}\nclass MultiModelOccurenceRequest extends OccurenceAtPositionRequest {\n    constructor(model, selection, wordSeparators, providers, otherModels) {\n        super(model, selection, wordSeparators);\n        this._providers = providers;\n        this._otherModels = otherModels;\n    }\n    _compute(model, selection, wordSeparators, token) {\n        return getOccurrencesAcrossMultipleModels(this._providers, model, selection.getPosition(), wordSeparators, token, this._otherModels).then(value => {\n            if (!value) {\n                return new ResourceMap();\n            }\n            return value;\n        });\n    }\n}\nclass TextualOccurenceRequest extends OccurenceAtPositionRequest {\n    constructor(model, selection, word, wordSeparators, otherModels) {\n        super(model, selection, wordSeparators);\n        this._otherModels = otherModels;\n        this._selectionIsEmpty = selection.isEmpty();\n        this._word = word;\n    }\n    _compute(model, selection, wordSeparators, token) {\n        return timeout(250, token).then(() => {\n            const result = new ResourceMap();\n            let wordResult;\n            if (this._word) {\n                wordResult = this._word;\n            }\n            else {\n                wordResult = model.getWordAtPosition(selection.getPosition());\n            }\n            if (!wordResult) {\n                return new ResourceMap();\n            }\n            const allModels = [model, ...this._otherModels];\n            for (const otherModel of allModels) {\n                if (otherModel.isDisposed()) {\n                    continue;\n                }\n                const matches = otherModel.findMatches(wordResult.word, true, false, true, wordSeparators, false);\n                const highlights = matches.map(m => ({\n                    range: m.range,\n                    kind: DocumentHighlightKind.Text\n                }));\n                if (highlights) {\n                    result.set(otherModel.uri, highlights);\n                }\n            }\n            return result;\n        });\n    }\n    isValid(model, selection, decorations) {\n        const currentSelectionIsEmpty = selection.isEmpty();\n        if (this._selectionIsEmpty !== currentSelectionIsEmpty) {\n            return false;\n        }\n        return super.isValid(model, selection, decorations);\n    }\n}\nfunction computeOccurencesAtPosition(registry, model, selection, word, wordSeparators) {\n    if (registry.has(model)) {\n        return new SemanticOccurenceAtPositionRequest(model, selection, wordSeparators, registry);\n    }\n    return new TextualOccurenceRequest(model, selection, word, wordSeparators, []);\n}\nfunction computeOccurencesMultiModel(registry, model, selection, word, wordSeparators, otherModels) {\n    if (registry.has(model)) {\n        return new MultiModelOccurenceRequest(model, selection, wordSeparators, registry, otherModels);\n    }\n    return new TextualOccurenceRequest(model, selection, word, wordSeparators, otherModels);\n}\nregisterModelAndPositionCommand('_executeDocumentHighlights', async (accessor, model, position) => {\n    const languageFeaturesService = accessor.get(ILanguageFeaturesService);\n    const map = await getOccurrencesAtPosition(languageFeaturesService.documentHighlightProvider, model, position, CancellationToken.None);\n    return map === null || map === void 0 ? void 0 : map.get(model.uri);\n});\nlet WordHighlighter = WordHighlighter_1 = class WordHighlighter {\n    constructor(editor, providers, multiProviders, contextKeyService, codeEditorService) {\n        this.toUnhook = new DisposableStore();\n        this.workerRequestTokenId = 0;\n        this.workerRequestCompleted = false;\n        this.workerRequestValue = new ResourceMap();\n        this.lastCursorPositionChangeTime = 0;\n        this.renderDecorationsTimer = -1;\n        this.editor = editor;\n        this.providers = providers;\n        this.multiDocumentProviders = multiProviders;\n        this.codeEditorService = codeEditorService;\n        this._hasWordHighlights = ctxHasWordHighlights.bindTo(contextKeyService);\n        this._ignorePositionChangeEvent = false;\n        this.occurrencesHighlight = this.editor.getOption(81 /* EditorOption.occurrencesHighlight */);\n        this.model = this.editor.getModel();\n        this.toUnhook.add(editor.onDidChangeCursorPosition((e) => {\n            if (this._ignorePositionChangeEvent) {\n                // We are changing the position => ignore this event\n                return;\n            }\n            if (this.occurrencesHighlight === 'off') {\n                // Early exit if nothing needs to be done!\n                // Leave some form of early exit check here if you wish to continue being a cursor position change listener ;)\n                return;\n            }\n            this._onPositionChanged(e);\n        }));\n        this.toUnhook.add(editor.onDidFocusEditorText((e) => {\n            if (this.occurrencesHighlight === 'off') {\n                // Early exit if nothing needs to be done\n                return;\n            }\n            if (!this.workerRequest) {\n                this._run();\n            }\n        }));\n        this.toUnhook.add(editor.onDidChangeModelContent((e) => {\n            this._stopAll();\n        }));\n        this.toUnhook.add(editor.onDidChangeModel((e) => {\n            if (!e.newModelUrl && e.oldModelUrl) {\n                this._stopSingular();\n            }\n            else {\n                if (WordHighlighter_1.query) {\n                    this._run();\n                }\n            }\n        }));\n        this.toUnhook.add(editor.onDidChangeConfiguration((e) => {\n            const newValue = this.editor.getOption(81 /* EditorOption.occurrencesHighlight */);\n            if (this.occurrencesHighlight !== newValue) {\n                this.occurrencesHighlight = newValue;\n                this._stopAll();\n            }\n        }));\n        this.decorations = this.editor.createDecorationsCollection();\n        this.workerRequestTokenId = 0;\n        this.workerRequest = null;\n        this.workerRequestCompleted = false;\n        this.lastCursorPositionChangeTime = 0;\n        this.renderDecorationsTimer = -1;\n        // if there is a query already, highlight off that query\n        if (WordHighlighter_1.query) {\n            this._run();\n        }\n    }\n    hasDecorations() {\n        return (this.decorations.length > 0);\n    }\n    restore() {\n        if (this.occurrencesHighlight === 'off') {\n            return;\n        }\n        this._run();\n    }\n    _getSortedHighlights() {\n        return (this.decorations.getRanges()\n            .sort(Range.compareRangesUsingStarts));\n    }\n    moveNext() {\n        const highlights = this._getSortedHighlights();\n        const index = highlights.findIndex((range) => range.containsPosition(this.editor.getPosition()));\n        const newIndex = ((index + 1) % highlights.length);\n        const dest = highlights[newIndex];\n        try {\n            this._ignorePositionChangeEvent = true;\n            this.editor.setPosition(dest.getStartPosition());\n            this.editor.revealRangeInCenterIfOutsideViewport(dest);\n            const word = this._getWord();\n            if (word) {\n                const lineContent = this.editor.getModel().getLineContent(dest.startLineNumber);\n                alert(`${lineContent}, ${newIndex + 1} of ${highlights.length} for '${word.word}'`);\n            }\n        }\n        finally {\n            this._ignorePositionChangeEvent = false;\n        }\n    }\n    moveBack() {\n        const highlights = this._getSortedHighlights();\n        const index = highlights.findIndex((range) => range.containsPosition(this.editor.getPosition()));\n        const newIndex = ((index - 1 + highlights.length) % highlights.length);\n        const dest = highlights[newIndex];\n        try {\n            this._ignorePositionChangeEvent = true;\n            this.editor.setPosition(dest.getStartPosition());\n            this.editor.revealRangeInCenterIfOutsideViewport(dest);\n            const word = this._getWord();\n            if (word) {\n                const lineContent = this.editor.getModel().getLineContent(dest.startLineNumber);\n                alert(`${lineContent}, ${newIndex + 1} of ${highlights.length} for '${word.word}'`);\n            }\n        }\n        finally {\n            this._ignorePositionChangeEvent = false;\n        }\n    }\n    _removeSingleDecorations() {\n        // return if no model\n        if (!this.editor.hasModel()) {\n            return;\n        }\n        const currentDecorationIDs = WordHighlighter_1.storedDecorations.get(this.editor.getModel().uri);\n        if (!currentDecorationIDs) {\n            return;\n        }\n        this.editor.removeDecorations(currentDecorationIDs);\n        WordHighlighter_1.storedDecorations.delete(this.editor.getModel().uri);\n        if (this.decorations.length > 0) {\n            this.decorations.clear();\n            this._hasWordHighlights.set(false);\n        }\n    }\n    _removeAllDecorations() {\n        const currentEditors = this.codeEditorService.listCodeEditors();\n        const deleteURI = [];\n        // iterate over editors and store models in currentModels\n        for (const editor of currentEditors) {\n            if (!editor.hasModel()) {\n                continue;\n            }\n            const currentDecorationIDs = WordHighlighter_1.storedDecorations.get(editor.getModel().uri);\n            if (!currentDecorationIDs) {\n                continue;\n            }\n            editor.removeDecorations(currentDecorationIDs);\n            deleteURI.push(editor.getModel().uri);\n            const editorHighlighterContrib = WordHighlighterContribution.get(editor);\n            if (!(editorHighlighterContrib === null || editorHighlighterContrib === void 0 ? void 0 : editorHighlighterContrib.wordHighlighter)) {\n                continue;\n            }\n            if (editorHighlighterContrib.wordHighlighter.decorations.length > 0) {\n                editorHighlighterContrib.wordHighlighter.decorations.clear();\n                editorHighlighterContrib.wordHighlighter.workerRequest = null;\n                editorHighlighterContrib.wordHighlighter._hasWordHighlights.set(false);\n            }\n        }\n        for (const uri of deleteURI) {\n            WordHighlighter_1.storedDecorations.delete(uri);\n        }\n    }\n    _stopSingular() {\n        var _a, _b, _c, _d;\n        // Remove any existing decorations + a possible query, and re - run to update decorations\n        this._removeSingleDecorations();\n        if (this.editor.hasTextFocus()) {\n            if (((_a = this.editor.getModel()) === null || _a === void 0 ? void 0 : _a.uri.scheme) !== Schemas.vscodeNotebookCell && ((_c = (_b = WordHighlighter_1.query) === null || _b === void 0 ? void 0 : _b.modelInfo) === null || _c === void 0 ? void 0 : _c.model.uri.scheme) !== Schemas.vscodeNotebookCell) { // clear query if focused non-nb editor\n                WordHighlighter_1.query = null;\n                this._run(); // TODO: @Yoyokrazy -- investigate why we need a full rerun here. likely addressed a case/patch in the first iteration of this feature\n            }\n            else { // remove modelInfo to account for nb cell being disposed\n                if ((_d = WordHighlighter_1.query) === null || _d === void 0 ? void 0 : _d.modelInfo) {\n                    WordHighlighter_1.query.modelInfo = null;\n                }\n            }\n        }\n        // Cancel any renderDecorationsTimer\n        if (this.renderDecorationsTimer !== -1) {\n            clearTimeout(this.renderDecorationsTimer);\n            this.renderDecorationsTimer = -1;\n        }\n        // Cancel any worker request\n        if (this.workerRequest !== null) {\n            this.workerRequest.cancel();\n            this.workerRequest = null;\n        }\n        // Invalidate any worker request callback\n        if (!this.workerRequestCompleted) {\n            this.workerRequestTokenId++;\n            this.workerRequestCompleted = true;\n        }\n    }\n    _stopAll() {\n        // Remove any existing decorations\n        // TODO: @Yoyokrazy -- this triggers as notebooks scroll, causing highlights to disappear momentarily.\n        // maybe a nb type check?\n        this._removeAllDecorations();\n        // Cancel any renderDecorationsTimer\n        if (this.renderDecorationsTimer !== -1) {\n            clearTimeout(this.renderDecorationsTimer);\n            this.renderDecorationsTimer = -1;\n        }\n        // Cancel any worker request\n        if (this.workerRequest !== null) {\n            this.workerRequest.cancel();\n            this.workerRequest = null;\n        }\n        // Invalidate any worker request callback\n        if (!this.workerRequestCompleted) {\n            this.workerRequestTokenId++;\n            this.workerRequestCompleted = true;\n        }\n    }\n    _onPositionChanged(e) {\n        var _a;\n        // disabled\n        if (this.occurrencesHighlight === 'off') {\n            this._stopAll();\n            return;\n        }\n        // ignore typing & other\n        // need to check if the model is a notebook cell, should not stop if nb\n        if (e.reason !== 3 /* CursorChangeReason.Explicit */ && ((_a = this.editor.getModel()) === null || _a === void 0 ? void 0 : _a.uri.scheme) !== Schemas.vscodeNotebookCell) {\n            this._stopAll();\n            return;\n        }\n        this._run();\n    }\n    _getWord() {\n        const editorSelection = this.editor.getSelection();\n        const lineNumber = editorSelection.startLineNumber;\n        const startColumn = editorSelection.startColumn;\n        if (this.model.isDisposed()) {\n            return null;\n        }\n        return this.model.getWordAtPosition({\n            lineNumber: lineNumber,\n            column: startColumn\n        });\n    }\n    getOtherModelsToHighlight(model) {\n        if (!model) {\n            return [];\n        }\n        // notebook case\n        const isNotebookEditor = model.uri.scheme === Schemas.vscodeNotebookCell;\n        if (isNotebookEditor) {\n            const currentModels = [];\n            const currentEditors = this.codeEditorService.listCodeEditors();\n            for (const editor of currentEditors) {\n                const tempModel = editor.getModel();\n                if (tempModel && tempModel !== model && tempModel.uri.scheme === Schemas.vscodeNotebookCell) {\n                    currentModels.push(tempModel);\n                }\n            }\n            return currentModels;\n        }\n        // inline case\n        // ? current works when highlighting outside of an inline diff, highlighting in.\n        // ? broken when highlighting within a diff editor. highlighting the main editor does not work\n        // ? editor group service could be useful here\n        const currentModels = [];\n        const currentEditors = this.codeEditorService.listCodeEditors();\n        for (const editor of currentEditors) {\n            if (!isDiffEditor(editor)) {\n                continue;\n            }\n            const diffModel = editor.getModel();\n            if (!diffModel) {\n                continue;\n            }\n            if (model === diffModel.modified) { // embedded inline chat diff would pass this, allowing highlights\n                //? currentModels.push(diffModel.original);\n                currentModels.push(diffModel.modified);\n            }\n        }\n        if (currentModels.length) { // no matching editors have been found\n            return currentModels;\n        }\n        // multi-doc OFF\n        if (this.occurrencesHighlight === 'singleFile') {\n            return [];\n        }\n        // multi-doc ON\n        for (const editor of currentEditors) {\n            const tempModel = editor.getModel();\n            const isValidModel = tempModel && tempModel !== model;\n            if (isValidModel) {\n                currentModels.push(tempModel);\n            }\n        }\n        return currentModels;\n    }\n    _run() {\n        var _a;\n        let workerRequestIsValid;\n        const hasTextFocus = this.editor.hasTextFocus();\n        if (!hasTextFocus) { // new nb cell scrolled in, didChangeModel fires\n            if (!WordHighlighter_1.query) { // no previous query, nothing to highlight off of\n                return;\n            }\n        }\n        else { // has text focus\n            const editorSelection = this.editor.getSelection();\n            // ignore multiline selection\n            if (!editorSelection || editorSelection.startLineNumber !== editorSelection.endLineNumber) {\n                WordHighlighter_1.query = null;\n                this._stopAll();\n                return;\n            }\n            const startColumn = editorSelection.startColumn;\n            const endColumn = editorSelection.endColumn;\n            const word = this._getWord();\n            // The selection must be inside a word or surround one word at most\n            if (!word || word.startColumn > startColumn || word.endColumn < endColumn) {\n                // no previous query, nothing to highlight\n                WordHighlighter_1.query = null;\n                this._stopAll();\n                return;\n            }\n            // All the effort below is trying to achieve this:\n            // - when cursor is moved to a word, trigger immediately a findOccurrences request\n            // - 250ms later after the last cursor move event, render the occurrences\n            // - no flickering!\n            workerRequestIsValid = (this.workerRequest && this.workerRequest.isValid(this.model, editorSelection, this.decorations));\n            WordHighlighter_1.query = {\n                modelInfo: {\n                    model: this.model,\n                    selection: editorSelection,\n                },\n                word: word\n            };\n        }\n        // There are 4 cases:\n        // a) old workerRequest is valid & completed, renderDecorationsTimer fired\n        // b) old workerRequest is valid & completed, renderDecorationsTimer not fired\n        // c) old workerRequest is valid, but not completed\n        // d) old workerRequest is not valid\n        // For a) no action is needed\n        // For c), member 'lastCursorPositionChangeTime' will be used when installing the timer so no action is needed\n        this.lastCursorPositionChangeTime = (new Date()).getTime();\n        if (workerRequestIsValid) {\n            if (this.workerRequestCompleted && this.renderDecorationsTimer !== -1) {\n                // case b)\n                // Delay the firing of renderDecorationsTimer by an extra 250 ms\n                clearTimeout(this.renderDecorationsTimer);\n                this.renderDecorationsTimer = -1;\n                this._beginRenderDecorations();\n            }\n        }\n        else {\n            // case d)\n            // Stop all previous actions and start fresh\n            this._stopAll();\n            const myRequestId = ++this.workerRequestTokenId;\n            this.workerRequestCompleted = false;\n            const otherModelsToHighlight = this.getOtherModelsToHighlight(this.editor.getModel());\n            // when reaching here, there are two possible states.\n            // \t\t1) we have text focus, and a valid query was updated.\n            // \t\t2) we do not have text focus, and a valid query is cached.\n            // the query will ALWAYS have the correct data for the current highlight request, so it can always be passed to the workerRequest safely\n            if (!WordHighlighter_1.query.modelInfo || WordHighlighter_1.query.modelInfo.model.isDisposed()) {\n                return;\n            }\n            this.workerRequest = this.computeWithModel(WordHighlighter_1.query.modelInfo.model, WordHighlighter_1.query.modelInfo.selection, WordHighlighter_1.query.word, otherModelsToHighlight);\n            (_a = this.workerRequest) === null || _a === void 0 ? void 0 : _a.result.then(data => {\n                if (myRequestId === this.workerRequestTokenId) {\n                    this.workerRequestCompleted = true;\n                    this.workerRequestValue = data || [];\n                    this._beginRenderDecorations();\n                }\n            }, onUnexpectedError);\n        }\n    }\n    computeWithModel(model, selection, word, otherModels) {\n        if (!otherModels.length) {\n            return computeOccurencesAtPosition(this.providers, model, selection, word, this.editor.getOption(131 /* EditorOption.wordSeparators */));\n        }\n        else {\n            return computeOccurencesMultiModel(this.multiDocumentProviders, model, selection, word, this.editor.getOption(131 /* EditorOption.wordSeparators */), otherModels);\n        }\n    }\n    _beginRenderDecorations() {\n        const currentTime = (new Date()).getTime();\n        const minimumRenderTime = this.lastCursorPositionChangeTime + 250;\n        if (currentTime >= minimumRenderTime) {\n            // Synchronous\n            this.renderDecorationsTimer = -1;\n            this.renderDecorations();\n        }\n        else {\n            // Asynchronous\n            this.renderDecorationsTimer = setTimeout(() => {\n                this.renderDecorations();\n            }, (minimumRenderTime - currentTime));\n        }\n    }\n    renderDecorations() {\n        var _a, _b, _c;\n        this.renderDecorationsTimer = -1;\n        // create new loop, iterate over current editors using this.codeEditorService.listCodeEditors(),\n        // if the URI of that codeEditor is in the map, then add the decorations to the decorations array\n        // then set the decorations for the editor\n        const currentEditors = this.codeEditorService.listCodeEditors();\n        for (const editor of currentEditors) {\n            const editorHighlighterContrib = WordHighlighterContribution.get(editor);\n            if (!editorHighlighterContrib) {\n                continue;\n            }\n            const newDecorations = [];\n            const uri = (_a = editor.getModel()) === null || _a === void 0 ? void 0 : _a.uri;\n            if (uri && this.workerRequestValue.has(uri)) {\n                const oldDecorationIDs = WordHighlighter_1.storedDecorations.get(uri);\n                const newDocumentHighlights = this.workerRequestValue.get(uri);\n                if (newDocumentHighlights) {\n                    for (const highlight of newDocumentHighlights) {\n                        if (!highlight.range) {\n                            continue;\n                        }\n                        newDecorations.push({\n                            range: highlight.range,\n                            options: getHighlightDecorationOptions(highlight.kind)\n                        });\n                    }\n                }\n                let newDecorationIDs = [];\n                editor.changeDecorations((changeAccessor) => {\n                    newDecorationIDs = changeAccessor.deltaDecorations(oldDecorationIDs !== null && oldDecorationIDs !== void 0 ? oldDecorationIDs : [], newDecorations);\n                });\n                WordHighlighter_1.storedDecorations = WordHighlighter_1.storedDecorations.set(uri, newDecorationIDs);\n                if (newDecorations.length > 0) {\n                    (_b = editorHighlighterContrib.wordHighlighter) === null || _b === void 0 ? void 0 : _b.decorations.set(newDecorations);\n                    (_c = editorHighlighterContrib.wordHighlighter) === null || _c === void 0 ? void 0 : _c._hasWordHighlights.set(true);\n                }\n            }\n        }\n    }\n    dispose() {\n        this._stopSingular();\n        this.toUnhook.dispose();\n    }\n};\nWordHighlighter.storedDecorations = new ResourceMap();\nWordHighlighter.query = null;\nWordHighlighter = WordHighlighter_1 = __decorate([\n    __param(4, ICodeEditorService)\n], WordHighlighter);\nlet WordHighlighterContribution = WordHighlighterContribution_1 = class WordHighlighterContribution extends Disposable {\n    static get(editor) {\n        return editor.getContribution(WordHighlighterContribution_1.ID);\n    }\n    constructor(editor, contextKeyService, languageFeaturesService, codeEditorService) {\n        super();\n        this._wordHighlighter = null;\n        const createWordHighlighterIfPossible = () => {\n            if (editor.hasModel() && !editor.getModel().isTooLargeForTokenization()) {\n                this._wordHighlighter = new WordHighlighter(editor, languageFeaturesService.documentHighlightProvider, languageFeaturesService.multiDocumentHighlightProvider, contextKeyService, codeEditorService);\n            }\n        };\n        this._register(editor.onDidChangeModel((e) => {\n            if (this._wordHighlighter) {\n                this._wordHighlighter.dispose();\n                this._wordHighlighter = null;\n            }\n            createWordHighlighterIfPossible();\n        }));\n        createWordHighlighterIfPossible();\n    }\n    get wordHighlighter() {\n        return this._wordHighlighter;\n    }\n    saveViewState() {\n        if (this._wordHighlighter && this._wordHighlighter.hasDecorations()) {\n            return true;\n        }\n        return false;\n    }\n    moveNext() {\n        var _a;\n        (_a = this._wordHighlighter) === null || _a === void 0 ? void 0 : _a.moveNext();\n    }\n    moveBack() {\n        var _a;\n        (_a = this._wordHighlighter) === null || _a === void 0 ? void 0 : _a.moveBack();\n    }\n    restoreViewState(state) {\n        if (this._wordHighlighter && state) {\n            this._wordHighlighter.restore();\n        }\n    }\n    dispose() {\n        if (this._wordHighlighter) {\n            this._wordHighlighter.dispose();\n            this._wordHighlighter = null;\n        }\n        super.dispose();\n    }\n};\nWordHighlighterContribution.ID = 'editor.contrib.wordHighlighter';\nWordHighlighterContribution = WordHighlighterContribution_1 = __decorate([\n    __param(1, IContextKeyService),\n    __param(2, ILanguageFeaturesService),\n    __param(3, ICodeEditorService)\n], WordHighlighterContribution);\nexport { WordHighlighterContribution };\nclass WordHighlightNavigationAction extends EditorAction {\n    constructor(next, opts) {\n        super(opts);\n        this._isNext = next;\n    }\n    run(accessor, editor) {\n        const controller = WordHighlighterContribution.get(editor);\n        if (!controller) {\n            return;\n        }\n        if (this._isNext) {\n            controller.moveNext();\n        }\n        else {\n            controller.moveBack();\n        }\n    }\n}\nclass NextWordHighlightAction extends WordHighlightNavigationAction {\n    constructor() {\n        super(true, {\n            id: 'editor.action.wordHighlight.next',\n            label: nls.localize('wordHighlight.next.label', \"Go to Next Symbol Highlight\"),\n            alias: 'Go to Next Symbol Highlight',\n            precondition: ctxHasWordHighlights,\n            kbOpts: {\n                kbExpr: EditorContextKeys.editorTextFocus,\n                primary: 65 /* KeyCode.F7 */,\n                weight: 100 /* KeybindingWeight.EditorContrib */\n            }\n        });\n    }\n}\nclass PrevWordHighlightAction extends WordHighlightNavigationAction {\n    constructor() {\n        super(false, {\n            id: 'editor.action.wordHighlight.prev',\n            label: nls.localize('wordHighlight.previous.label', \"Go to Previous Symbol Highlight\"),\n            alias: 'Go to Previous Symbol Highlight',\n            precondition: ctxHasWordHighlights,\n            kbOpts: {\n                kbExpr: EditorContextKeys.editorTextFocus,\n                primary: 1024 /* KeyMod.Shift */ | 65 /* KeyCode.F7 */,\n                weight: 100 /* KeybindingWeight.EditorContrib */\n            }\n        });\n    }\n}\nclass TriggerWordHighlightAction extends EditorAction {\n    constructor() {\n        super({\n            id: 'editor.action.wordHighlight.trigger',\n            label: nls.localize('wordHighlight.trigger.label', \"Trigger Symbol Highlight\"),\n            alias: 'Trigger Symbol Highlight',\n            precondition: ctxHasWordHighlights.toNegated(),\n            kbOpts: {\n                kbExpr: EditorContextKeys.editorTextFocus,\n                primary: 0,\n                weight: 100 /* KeybindingWeight.EditorContrib */\n            }\n        });\n    }\n    run(accessor, editor, args) {\n        const controller = WordHighlighterContribution.get(editor);\n        if (!controller) {\n            return;\n        }\n        controller.restoreViewState(true);\n    }\n}\nregisterEditorContribution(WordHighlighterContribution.ID, WordHighlighterContribution, 0 /* EditorContributionInstantiation.Eager */); // eager because it uses `saveViewState`/`restoreViewState`\nregisterEditorAction(NextWordHighlightAction);\nregisterEditorAction(PrevWordHighlightAction);\nregisterEditorAction(TriggerWordHighlightAction);\n// registerEditorFeature(TextualMultiDocumentHighlightFeature);\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}