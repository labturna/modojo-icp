{"ast":null,"code":"/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport { coalesce } from '../../../../base/common/arrays.js';\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport { onUnexpectedExternalError } from '../../../../base/common/errors.js';\nimport { matchesSomeScheme, Schemas } from '../../../../base/common/network.js';\nimport { registerModelAndPositionCommand } from '../../../browser/editorExtensions.js';\nimport { ILanguageFeaturesService } from '../../../common/services/languageFeatures.js';\nimport { ReferencesModel } from './referencesModel.js';\nfunction shouldIncludeLocationLink(sourceModel, loc) {\n  // Always allow the location if the request comes from a document with the same scheme.\n  if (loc.uri.scheme === sourceModel.uri.scheme) {\n    return true;\n  }\n  // Otherwise filter out locations from internal schemes\n  if (matchesSomeScheme(loc.uri, Schemas.walkThroughSnippet, Schemas.vscodeChatCodeBlock, Schemas.vscodeChatCodeCompareBlock, Schemas.vscodeCopilotBackingChatCodeBlock)) {\n    return false;\n  }\n  return true;\n}\nasync function getLocationLinks(model, position, registry, provide) {\n  const provider = registry.ordered(model);\n  // get results\n  const promises = provider.map(provider => {\n    return Promise.resolve(provide(provider, model, position)).then(undefined, err => {\n      onUnexpectedExternalError(err);\n      return undefined;\n    });\n  });\n  const values = await Promise.all(promises);\n  return coalesce(values.flat()).filter(loc => shouldIncludeLocationLink(model, loc));\n}\nexport function getDefinitionsAtPosition(registry, model, position, token) {\n  return getLocationLinks(model, position, registry, (provider, model, position) => {\n    return provider.provideDefinition(model, position, token);\n  });\n}\nexport function getDeclarationsAtPosition(registry, model, position, token) {\n  return getLocationLinks(model, position, registry, (provider, model, position) => {\n    return provider.provideDeclaration(model, position, token);\n  });\n}\nexport function getImplementationsAtPosition(registry, model, position, token) {\n  return getLocationLinks(model, position, registry, (provider, model, position) => {\n    return provider.provideImplementation(model, position, token);\n  });\n}\nexport function getTypeDefinitionsAtPosition(registry, model, position, token) {\n  return getLocationLinks(model, position, registry, (provider, model, position) => {\n    return provider.provideTypeDefinition(model, position, token);\n  });\n}\nexport function getReferencesAtPosition(registry, model, position, compact, token) {\n  return getLocationLinks(model, position, registry, async (provider, model, position) => {\n    var _a, _b;\n    const result = (_a = await provider.provideReferences(model, position, {\n      includeDeclaration: true\n    }, token)) === null || _a === void 0 ? void 0 : _a.filter(ref => shouldIncludeLocationLink(model, ref));\n    if (!compact || !result || result.length !== 2) {\n      return result;\n    }\n    const resultWithoutDeclaration = (_b = await provider.provideReferences(model, position, {\n      includeDeclaration: false\n    }, token)) === null || _b === void 0 ? void 0 : _b.filter(ref => shouldIncludeLocationLink(model, ref));\n    if (resultWithoutDeclaration && resultWithoutDeclaration.length === 1) {\n      return resultWithoutDeclaration;\n    }\n    return result;\n  });\n}\n// -- API commands ----\nasync function _sortedAndDeduped(callback) {\n  const rawLinks = await callback();\n  const model = new ReferencesModel(rawLinks, '');\n  const modelLinks = model.references.map(ref => ref.link);\n  model.dispose();\n  return modelLinks;\n}\nregisterModelAndPositionCommand('_executeDefinitionProvider', (accessor, model, position) => {\n  const languageFeaturesService = accessor.get(ILanguageFeaturesService);\n  const promise = getDefinitionsAtPosition(languageFeaturesService.definitionProvider, model, position, CancellationToken.None);\n  return _sortedAndDeduped(() => promise);\n});\nregisterModelAndPositionCommand('_executeTypeDefinitionProvider', (accessor, model, position) => {\n  const languageFeaturesService = accessor.get(ILanguageFeaturesService);\n  const promise = getTypeDefinitionsAtPosition(languageFeaturesService.typeDefinitionProvider, model, position, CancellationToken.None);\n  return _sortedAndDeduped(() => promise);\n});\nregisterModelAndPositionCommand('_executeDeclarationProvider', (accessor, model, position) => {\n  const languageFeaturesService = accessor.get(ILanguageFeaturesService);\n  const promise = getDeclarationsAtPosition(languageFeaturesService.declarationProvider, model, position, CancellationToken.None);\n  return _sortedAndDeduped(() => promise);\n});\nregisterModelAndPositionCommand('_executeReferenceProvider', (accessor, model, position) => {\n  const languageFeaturesService = accessor.get(ILanguageFeaturesService);\n  const promise = getReferencesAtPosition(languageFeaturesService.referenceProvider, model, position, false, CancellationToken.None);\n  return _sortedAndDeduped(() => promise);\n});\nregisterModelAndPositionCommand('_executeImplementationProvider', (accessor, model, position) => {\n  const languageFeaturesService = accessor.get(ILanguageFeaturesService);\n  const promise = getImplementationsAtPosition(languageFeaturesService.implementationProvider, model, position, CancellationToken.None);\n  return _sortedAndDeduped(() => promise);\n});","map":{"version":3,"names":["coalesce","CancellationToken","onUnexpectedExternalError","matchesSomeScheme","Schemas","registerModelAndPositionCommand","ILanguageFeaturesService","ReferencesModel","shouldIncludeLocationLink","sourceModel","loc","uri","scheme","walkThroughSnippet","vscodeChatCodeBlock","vscodeChatCodeCompareBlock","vscodeCopilotBackingChatCodeBlock","getLocationLinks","model","position","registry","provide","provider","ordered","promises","map","Promise","resolve","then","undefined","err","values","all","flat","filter","getDefinitionsAtPosition","token","provideDefinition","getDeclarationsAtPosition","provideDeclaration","getImplementationsAtPosition","provideImplementation","getTypeDefinitionsAtPosition","provideTypeDefinition","getReferencesAtPosition","compact","_a","_b","result","provideReferences","includeDeclaration","ref","length","resultWithoutDeclaration","_sortedAndDeduped","callback","rawLinks","modelLinks","references","link","dispose","accessor","languageFeaturesService","get","promise","definitionProvider","None","typeDefinitionProvider","declarationProvider","referenceProvider","implementationProvider"],"sources":["/home/arslan/modojo/node_modules/monaco-editor/esm/vs/editor/contrib/gotoSymbol/browser/goToSymbol.js"],"sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport { coalesce } from '../../../../base/common/arrays.js';\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport { onUnexpectedExternalError } from '../../../../base/common/errors.js';\nimport { matchesSomeScheme, Schemas } from '../../../../base/common/network.js';\nimport { registerModelAndPositionCommand } from '../../../browser/editorExtensions.js';\nimport { ILanguageFeaturesService } from '../../../common/services/languageFeatures.js';\nimport { ReferencesModel } from './referencesModel.js';\nfunction shouldIncludeLocationLink(sourceModel, loc) {\n    // Always allow the location if the request comes from a document with the same scheme.\n    if (loc.uri.scheme === sourceModel.uri.scheme) {\n        return true;\n    }\n    // Otherwise filter out locations from internal schemes\n    if (matchesSomeScheme(loc.uri, Schemas.walkThroughSnippet, Schemas.vscodeChatCodeBlock, Schemas.vscodeChatCodeCompareBlock, Schemas.vscodeCopilotBackingChatCodeBlock)) {\n        return false;\n    }\n    return true;\n}\nasync function getLocationLinks(model, position, registry, provide) {\n    const provider = registry.ordered(model);\n    // get results\n    const promises = provider.map((provider) => {\n        return Promise.resolve(provide(provider, model, position)).then(undefined, err => {\n            onUnexpectedExternalError(err);\n            return undefined;\n        });\n    });\n    const values = await Promise.all(promises);\n    return coalesce(values.flat()).filter(loc => shouldIncludeLocationLink(model, loc));\n}\nexport function getDefinitionsAtPosition(registry, model, position, token) {\n    return getLocationLinks(model, position, registry, (provider, model, position) => {\n        return provider.provideDefinition(model, position, token);\n    });\n}\nexport function getDeclarationsAtPosition(registry, model, position, token) {\n    return getLocationLinks(model, position, registry, (provider, model, position) => {\n        return provider.provideDeclaration(model, position, token);\n    });\n}\nexport function getImplementationsAtPosition(registry, model, position, token) {\n    return getLocationLinks(model, position, registry, (provider, model, position) => {\n        return provider.provideImplementation(model, position, token);\n    });\n}\nexport function getTypeDefinitionsAtPosition(registry, model, position, token) {\n    return getLocationLinks(model, position, registry, (provider, model, position) => {\n        return provider.provideTypeDefinition(model, position, token);\n    });\n}\nexport function getReferencesAtPosition(registry, model, position, compact, token) {\n    return getLocationLinks(model, position, registry, async (provider, model, position) => {\n        var _a, _b;\n        const result = (_a = (await provider.provideReferences(model, position, { includeDeclaration: true }, token))) === null || _a === void 0 ? void 0 : _a.filter(ref => shouldIncludeLocationLink(model, ref));\n        if (!compact || !result || result.length !== 2) {\n            return result;\n        }\n        const resultWithoutDeclaration = (_b = (await provider.provideReferences(model, position, { includeDeclaration: false }, token))) === null || _b === void 0 ? void 0 : _b.filter(ref => shouldIncludeLocationLink(model, ref));\n        if (resultWithoutDeclaration && resultWithoutDeclaration.length === 1) {\n            return resultWithoutDeclaration;\n        }\n        return result;\n    });\n}\n// -- API commands ----\nasync function _sortedAndDeduped(callback) {\n    const rawLinks = await callback();\n    const model = new ReferencesModel(rawLinks, '');\n    const modelLinks = model.references.map(ref => ref.link);\n    model.dispose();\n    return modelLinks;\n}\nregisterModelAndPositionCommand('_executeDefinitionProvider', (accessor, model, position) => {\n    const languageFeaturesService = accessor.get(ILanguageFeaturesService);\n    const promise = getDefinitionsAtPosition(languageFeaturesService.definitionProvider, model, position, CancellationToken.None);\n    return _sortedAndDeduped(() => promise);\n});\nregisterModelAndPositionCommand('_executeTypeDefinitionProvider', (accessor, model, position) => {\n    const languageFeaturesService = accessor.get(ILanguageFeaturesService);\n    const promise = getTypeDefinitionsAtPosition(languageFeaturesService.typeDefinitionProvider, model, position, CancellationToken.None);\n    return _sortedAndDeduped(() => promise);\n});\nregisterModelAndPositionCommand('_executeDeclarationProvider', (accessor, model, position) => {\n    const languageFeaturesService = accessor.get(ILanguageFeaturesService);\n    const promise = getDeclarationsAtPosition(languageFeaturesService.declarationProvider, model, position, CancellationToken.None);\n    return _sortedAndDeduped(() => promise);\n});\nregisterModelAndPositionCommand('_executeReferenceProvider', (accessor, model, position) => {\n    const languageFeaturesService = accessor.get(ILanguageFeaturesService);\n    const promise = getReferencesAtPosition(languageFeaturesService.referenceProvider, model, position, false, CancellationToken.None);\n    return _sortedAndDeduped(() => promise);\n});\nregisterModelAndPositionCommand('_executeImplementationProvider', (accessor, model, position) => {\n    const languageFeaturesService = accessor.get(ILanguageFeaturesService);\n    const promise = getImplementationsAtPosition(languageFeaturesService.implementationProvider, model, position, CancellationToken.None);\n    return _sortedAndDeduped(() => promise);\n});\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}