{"ast":null,"code":"/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport * as arrays from '../../../base/common/arrays.js';\nimport { ResourceMap } from '../../../base/common/map.js';\nimport * as objects from '../../../base/common/objects.js';\nimport * as types from '../../../base/common/types.js';\nimport { URI } from '../../../base/common/uri.js';\nimport { addToValueTree, getConfigurationValue, removeFromValueTree, toValuesTree } from './configuration.js';\nimport { Extensions, overrideIdentifiersFromKey, OVERRIDE_PROPERTY_REGEX } from './configurationRegistry.js';\nimport { Registry } from '../../registry/common/platform.js';\nfunction freeze(data) {\n  return Object.isFrozen(data) ? data : objects.deepFreeze(data);\n}\nexport class ConfigurationModel {\n  static createEmptyModel(logService) {\n    return new ConfigurationModel({}, [], [], undefined, logService);\n  }\n  constructor(_contents, _keys, _overrides, raw, logService) {\n    this._contents = _contents;\n    this._keys = _keys;\n    this._overrides = _overrides;\n    this.raw = raw;\n    this.logService = logService;\n    this.overrideConfigurations = new Map();\n  }\n  get rawConfiguration() {\n    var _a;\n    if (!this._rawConfiguration) {\n      if ((_a = this.raw) === null || _a === void 0 ? void 0 : _a.length) {\n        const rawConfigurationModels = this.raw.map(raw => {\n          if (raw instanceof ConfigurationModel) {\n            return raw;\n          }\n          const parser = new ConfigurationModelParser('', this.logService);\n          parser.parseRaw(raw);\n          return parser.configurationModel;\n        });\n        this._rawConfiguration = rawConfigurationModels.reduce((previous, current) => current === previous ? current : previous.merge(current), rawConfigurationModels[0]);\n      } else {\n        // raw is same as current\n        this._rawConfiguration = this;\n      }\n    }\n    return this._rawConfiguration;\n  }\n  get contents() {\n    return this._contents;\n  }\n  get overrides() {\n    return this._overrides;\n  }\n  get keys() {\n    return this._keys;\n  }\n  isEmpty() {\n    return this._keys.length === 0 && Object.keys(this._contents).length === 0 && this._overrides.length === 0;\n  }\n  getValue(section) {\n    return section ? getConfigurationValue(this.contents, section) : this.contents;\n  }\n  inspect(section, overrideIdentifier) {\n    const that = this;\n    return {\n      get value() {\n        return freeze(that.rawConfiguration.getValue(section));\n      },\n      get override() {\n        return overrideIdentifier ? freeze(that.rawConfiguration.getOverrideValue(section, overrideIdentifier)) : undefined;\n      },\n      get merged() {\n        return freeze(overrideIdentifier ? that.rawConfiguration.override(overrideIdentifier).getValue(section) : that.rawConfiguration.getValue(section));\n      },\n      get overrides() {\n        const overrides = [];\n        for (const {\n          contents,\n          identifiers,\n          keys\n        } of that.rawConfiguration.overrides) {\n          const value = new ConfigurationModel(contents, keys, [], undefined, that.logService).getValue(section);\n          if (value !== undefined) {\n            overrides.push({\n              identifiers,\n              value\n            });\n          }\n        }\n        return overrides.length ? freeze(overrides) : undefined;\n      }\n    };\n  }\n  getOverrideValue(section, overrideIdentifier) {\n    const overrideContents = this.getContentsForOverrideIdentifer(overrideIdentifier);\n    return overrideContents ? section ? getConfigurationValue(overrideContents, section) : overrideContents : undefined;\n  }\n  override(identifier) {\n    let overrideConfigurationModel = this.overrideConfigurations.get(identifier);\n    if (!overrideConfigurationModel) {\n      overrideConfigurationModel = this.createOverrideConfigurationModel(identifier);\n      this.overrideConfigurations.set(identifier, overrideConfigurationModel);\n    }\n    return overrideConfigurationModel;\n  }\n  merge() {\n    var _a, _b;\n    const contents = objects.deepClone(this.contents);\n    const overrides = objects.deepClone(this.overrides);\n    const keys = [...this.keys];\n    const raws = ((_a = this.raw) === null || _a === void 0 ? void 0 : _a.length) ? [...this.raw] : [this];\n    for (var _len = arguments.length, others = new Array(_len), _key = 0; _key < _len; _key++) {\n      others[_key] = arguments[_key];\n    }\n    for (const other of others) {\n      raws.push(...(((_b = other.raw) === null || _b === void 0 ? void 0 : _b.length) ? other.raw : [other]));\n      if (other.isEmpty()) {\n        continue;\n      }\n      this.mergeContents(contents, other.contents);\n      for (const otherOverride of other.overrides) {\n        const [override] = overrides.filter(o => arrays.equals(o.identifiers, otherOverride.identifiers));\n        if (override) {\n          this.mergeContents(override.contents, otherOverride.contents);\n          override.keys.push(...otherOverride.keys);\n          override.keys = arrays.distinct(override.keys);\n        } else {\n          overrides.push(objects.deepClone(otherOverride));\n        }\n      }\n      for (const key of other.keys) {\n        if (keys.indexOf(key) === -1) {\n          keys.push(key);\n        }\n      }\n    }\n    return new ConfigurationModel(contents, keys, overrides, raws.every(raw => raw instanceof ConfigurationModel) ? undefined : raws, this.logService);\n  }\n  createOverrideConfigurationModel(identifier) {\n    const overrideContents = this.getContentsForOverrideIdentifer(identifier);\n    if (!overrideContents || typeof overrideContents !== 'object' || !Object.keys(overrideContents).length) {\n      // If there are no valid overrides, return self\n      return this;\n    }\n    const contents = {};\n    for (const key of arrays.distinct([...Object.keys(this.contents), ...Object.keys(overrideContents)])) {\n      let contentsForKey = this.contents[key];\n      const overrideContentsForKey = overrideContents[key];\n      // If there are override contents for the key, clone and merge otherwise use base contents\n      if (overrideContentsForKey) {\n        // Clone and merge only if base contents and override contents are of type object otherwise just override\n        if (typeof contentsForKey === 'object' && typeof overrideContentsForKey === 'object') {\n          contentsForKey = objects.deepClone(contentsForKey);\n          this.mergeContents(contentsForKey, overrideContentsForKey);\n        } else {\n          contentsForKey = overrideContentsForKey;\n        }\n      }\n      contents[key] = contentsForKey;\n    }\n    return new ConfigurationModel(contents, this.keys, this.overrides, undefined, this.logService);\n  }\n  mergeContents(source, target) {\n    for (const key of Object.keys(target)) {\n      if (key in source) {\n        if (types.isObject(source[key]) && types.isObject(target[key])) {\n          this.mergeContents(source[key], target[key]);\n          continue;\n        }\n      }\n      source[key] = objects.deepClone(target[key]);\n    }\n  }\n  getContentsForOverrideIdentifer(identifier) {\n    let contentsForIdentifierOnly = null;\n    let contents = null;\n    const mergeContents = contentsToMerge => {\n      if (contentsToMerge) {\n        if (contents) {\n          this.mergeContents(contents, contentsToMerge);\n        } else {\n          contents = objects.deepClone(contentsToMerge);\n        }\n      }\n    };\n    for (const override of this.overrides) {\n      if (override.identifiers.length === 1 && override.identifiers[0] === identifier) {\n        contentsForIdentifierOnly = override.contents;\n      } else if (override.identifiers.includes(identifier)) {\n        mergeContents(override.contents);\n      }\n    }\n    // Merge contents of the identifier only at the end to take precedence.\n    mergeContents(contentsForIdentifierOnly);\n    return contents;\n  }\n  toJSON() {\n    return {\n      contents: this.contents,\n      overrides: this.overrides,\n      keys: this.keys\n    };\n  }\n  // Update methods\n  addValue(key, value) {\n    this.updateValue(key, value, true);\n  }\n  setValue(key, value) {\n    this.updateValue(key, value, false);\n  }\n  removeValue(key) {\n    const index = this.keys.indexOf(key);\n    if (index === -1) {\n      return;\n    }\n    this.keys.splice(index, 1);\n    removeFromValueTree(this.contents, key);\n    if (OVERRIDE_PROPERTY_REGEX.test(key)) {\n      this.overrides.splice(this.overrides.findIndex(o => arrays.equals(o.identifiers, overrideIdentifiersFromKey(key))), 1);\n    }\n  }\n  updateValue(key, value, add) {\n    addToValueTree(this.contents, key, value, e => this.logService.error(e));\n    add = add || this.keys.indexOf(key) === -1;\n    if (add) {\n      this.keys.push(key);\n    }\n    if (OVERRIDE_PROPERTY_REGEX.test(key)) {\n      this.overrides.push({\n        identifiers: overrideIdentifiersFromKey(key),\n        keys: Object.keys(this.contents[key]),\n        contents: toValuesTree(this.contents[key], message => this.logService.error(message))\n      });\n    }\n  }\n}\nexport class ConfigurationModelParser {\n  constructor(_name, logService) {\n    this._name = _name;\n    this.logService = logService;\n    this._raw = null;\n    this._configurationModel = null;\n    this._restrictedConfigurations = [];\n  }\n  get configurationModel() {\n    return this._configurationModel || ConfigurationModel.createEmptyModel(this.logService);\n  }\n  parseRaw(raw, options) {\n    this._raw = raw;\n    const {\n      contents,\n      keys,\n      overrides,\n      restricted,\n      hasExcludedProperties\n    } = this.doParseRaw(raw, options);\n    this._configurationModel = new ConfigurationModel(contents, keys, overrides, hasExcludedProperties ? [raw] : undefined /* raw has not changed */, this.logService);\n    this._restrictedConfigurations = restricted || [];\n  }\n  doParseRaw(raw, options) {\n    const configurationProperties = Registry.as(Extensions.Configuration).getConfigurationProperties();\n    const filtered = this.filter(raw, configurationProperties, true, options);\n    raw = filtered.raw;\n    const contents = toValuesTree(raw, message => this.logService.error(`Conflict in settings file ${this._name}: ${message}`));\n    const keys = Object.keys(raw);\n    const overrides = this.toOverrides(raw, message => this.logService.error(`Conflict in settings file ${this._name}: ${message}`));\n    return {\n      contents,\n      keys,\n      overrides,\n      restricted: filtered.restricted,\n      hasExcludedProperties: filtered.hasExcludedProperties\n    };\n  }\n  filter(properties, configurationProperties, filterOverriddenProperties, options) {\n    var _a, _b, _c;\n    let hasExcludedProperties = false;\n    if (!(options === null || options === void 0 ? void 0 : options.scopes) && !(options === null || options === void 0 ? void 0 : options.skipRestricted) && !((_a = options === null || options === void 0 ? void 0 : options.exclude) === null || _a === void 0 ? void 0 : _a.length)) {\n      return {\n        raw: properties,\n        restricted: [],\n        hasExcludedProperties\n      };\n    }\n    const raw = {};\n    const restricted = [];\n    for (const key in properties) {\n      if (OVERRIDE_PROPERTY_REGEX.test(key) && filterOverriddenProperties) {\n        const result = this.filter(properties[key], configurationProperties, false, options);\n        raw[key] = result.raw;\n        hasExcludedProperties = hasExcludedProperties || result.hasExcludedProperties;\n        restricted.push(...result.restricted);\n      } else {\n        const propertySchema = configurationProperties[key];\n        const scope = propertySchema ? typeof propertySchema.scope !== 'undefined' ? propertySchema.scope : 3 /* ConfigurationScope.WINDOW */ : undefined;\n        if (propertySchema === null || propertySchema === void 0 ? void 0 : propertySchema.restricted) {\n          restricted.push(key);\n        }\n        if (!((_b = options.exclude) === null || _b === void 0 ? void 0 : _b.includes(key)) /* Check exclude */ && (((_c = options.include) === null || _c === void 0 ? void 0 : _c.includes(key) /* Check include */) || (scope === undefined || options.scopes === undefined || options.scopes.includes(scope) /* Check scopes */) && !(options.skipRestricted && (propertySchema === null || propertySchema === void 0 ? void 0 : propertySchema.restricted)))) /* Check restricted */{\n            raw[key] = properties[key];\n          } else {\n          hasExcludedProperties = true;\n        }\n      }\n    }\n    return {\n      raw,\n      restricted,\n      hasExcludedProperties\n    };\n  }\n  toOverrides(raw, conflictReporter) {\n    const overrides = [];\n    for (const key of Object.keys(raw)) {\n      if (OVERRIDE_PROPERTY_REGEX.test(key)) {\n        const overrideRaw = {};\n        for (const keyInOverrideRaw in raw[key]) {\n          overrideRaw[keyInOverrideRaw] = raw[key][keyInOverrideRaw];\n        }\n        overrides.push({\n          identifiers: overrideIdentifiersFromKey(key),\n          keys: Object.keys(overrideRaw),\n          contents: toValuesTree(overrideRaw, conflictReporter)\n        });\n      }\n    }\n    return overrides;\n  }\n}\nclass ConfigurationInspectValue {\n  constructor(key, overrides, _value, overrideIdentifiers, defaultConfiguration, policyConfiguration, applicationConfiguration, userConfiguration, localUserConfiguration, remoteUserConfiguration, workspaceConfiguration, folderConfigurationModel, memoryConfigurationModel) {\n    this.key = key;\n    this.overrides = overrides;\n    this._value = _value;\n    this.overrideIdentifiers = overrideIdentifiers;\n    this.defaultConfiguration = defaultConfiguration;\n    this.policyConfiguration = policyConfiguration;\n    this.applicationConfiguration = applicationConfiguration;\n    this.userConfiguration = userConfiguration;\n    this.localUserConfiguration = localUserConfiguration;\n    this.remoteUserConfiguration = remoteUserConfiguration;\n    this.workspaceConfiguration = workspaceConfiguration;\n    this.folderConfigurationModel = folderConfigurationModel;\n    this.memoryConfigurationModel = memoryConfigurationModel;\n  }\n  toInspectValue(inspectValue) {\n    return (inspectValue === null || inspectValue === void 0 ? void 0 : inspectValue.value) !== undefined || (inspectValue === null || inspectValue === void 0 ? void 0 : inspectValue.override) !== undefined || (inspectValue === null || inspectValue === void 0 ? void 0 : inspectValue.overrides) !== undefined ? inspectValue : undefined;\n  }\n  get userInspectValue() {\n    if (!this._userInspectValue) {\n      this._userInspectValue = this.userConfiguration.inspect(this.key, this.overrides.overrideIdentifier);\n    }\n    return this._userInspectValue;\n  }\n  get user() {\n    return this.toInspectValue(this.userInspectValue);\n  }\n}\nexport class Configuration {\n  constructor(_defaultConfiguration, _policyConfiguration, _applicationConfiguration, _localUserConfiguration, _remoteUserConfiguration, _workspaceConfiguration, _folderConfigurations, _memoryConfiguration, _memoryConfigurationByResource, logService) {\n    this._defaultConfiguration = _defaultConfiguration;\n    this._policyConfiguration = _policyConfiguration;\n    this._applicationConfiguration = _applicationConfiguration;\n    this._localUserConfiguration = _localUserConfiguration;\n    this._remoteUserConfiguration = _remoteUserConfiguration;\n    this._workspaceConfiguration = _workspaceConfiguration;\n    this._folderConfigurations = _folderConfigurations;\n    this._memoryConfiguration = _memoryConfiguration;\n    this._memoryConfigurationByResource = _memoryConfigurationByResource;\n    this.logService = logService;\n    this._workspaceConsolidatedConfiguration = null;\n    this._foldersConsolidatedConfigurations = new ResourceMap();\n    this._userConfiguration = null;\n  }\n  getValue(section, overrides, workspace) {\n    const consolidateConfigurationModel = this.getConsolidatedConfigurationModel(section, overrides, workspace);\n    return consolidateConfigurationModel.getValue(section);\n  }\n  updateValue(key, value) {\n    let overrides = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n    let memoryConfiguration;\n    if (overrides.resource) {\n      memoryConfiguration = this._memoryConfigurationByResource.get(overrides.resource);\n      if (!memoryConfiguration) {\n        memoryConfiguration = ConfigurationModel.createEmptyModel(this.logService);\n        this._memoryConfigurationByResource.set(overrides.resource, memoryConfiguration);\n      }\n    } else {\n      memoryConfiguration = this._memoryConfiguration;\n    }\n    if (value === undefined) {\n      memoryConfiguration.removeValue(key);\n    } else {\n      memoryConfiguration.setValue(key, value);\n    }\n    if (!overrides.resource) {\n      this._workspaceConsolidatedConfiguration = null;\n    }\n  }\n  inspect(key, overrides, workspace) {\n    const consolidateConfigurationModel = this.getConsolidatedConfigurationModel(key, overrides, workspace);\n    const folderConfigurationModel = this.getFolderConfigurationModelForResource(overrides.resource, workspace);\n    const memoryConfigurationModel = overrides.resource ? this._memoryConfigurationByResource.get(overrides.resource) || this._memoryConfiguration : this._memoryConfiguration;\n    const overrideIdentifiers = new Set();\n    for (const override of consolidateConfigurationModel.overrides) {\n      for (const overrideIdentifier of override.identifiers) {\n        if (consolidateConfigurationModel.getOverrideValue(key, overrideIdentifier) !== undefined) {\n          overrideIdentifiers.add(overrideIdentifier);\n        }\n      }\n    }\n    return new ConfigurationInspectValue(key, overrides, consolidateConfigurationModel.getValue(key), overrideIdentifiers.size ? [...overrideIdentifiers] : undefined, this._defaultConfiguration, this._policyConfiguration.isEmpty() ? undefined : this._policyConfiguration, this.applicationConfiguration.isEmpty() ? undefined : this.applicationConfiguration, this.userConfiguration, this.localUserConfiguration, this.remoteUserConfiguration, workspace ? this._workspaceConfiguration : undefined, folderConfigurationModel ? folderConfigurationModel : undefined, memoryConfigurationModel);\n  }\n  get applicationConfiguration() {\n    return this._applicationConfiguration;\n  }\n  get userConfiguration() {\n    if (!this._userConfiguration) {\n      this._userConfiguration = this._remoteUserConfiguration.isEmpty() ? this._localUserConfiguration : this._localUserConfiguration.merge(this._remoteUserConfiguration);\n    }\n    return this._userConfiguration;\n  }\n  get localUserConfiguration() {\n    return this._localUserConfiguration;\n  }\n  get remoteUserConfiguration() {\n    return this._remoteUserConfiguration;\n  }\n  getConsolidatedConfigurationModel(section, overrides, workspace) {\n    let configurationModel = this.getConsolidatedConfigurationModelForResource(overrides, workspace);\n    if (overrides.overrideIdentifier) {\n      configurationModel = configurationModel.override(overrides.overrideIdentifier);\n    }\n    if (!this._policyConfiguration.isEmpty() && this._policyConfiguration.getValue(section) !== undefined) {\n      configurationModel = configurationModel.merge(this._policyConfiguration);\n    }\n    return configurationModel;\n  }\n  getConsolidatedConfigurationModelForResource(_ref, workspace) {\n    let {\n      resource\n    } = _ref;\n    let consolidateConfiguration = this.getWorkspaceConsolidatedConfiguration();\n    if (workspace && resource) {\n      const root = workspace.getFolder(resource);\n      if (root) {\n        consolidateConfiguration = this.getFolderConsolidatedConfiguration(root.uri) || consolidateConfiguration;\n      }\n      const memoryConfigurationForResource = this._memoryConfigurationByResource.get(resource);\n      if (memoryConfigurationForResource) {\n        consolidateConfiguration = consolidateConfiguration.merge(memoryConfigurationForResource);\n      }\n    }\n    return consolidateConfiguration;\n  }\n  getWorkspaceConsolidatedConfiguration() {\n    if (!this._workspaceConsolidatedConfiguration) {\n      this._workspaceConsolidatedConfiguration = this._defaultConfiguration.merge(this.applicationConfiguration, this.userConfiguration, this._workspaceConfiguration, this._memoryConfiguration);\n    }\n    return this._workspaceConsolidatedConfiguration;\n  }\n  getFolderConsolidatedConfiguration(folder) {\n    let folderConsolidatedConfiguration = this._foldersConsolidatedConfigurations.get(folder);\n    if (!folderConsolidatedConfiguration) {\n      const workspaceConsolidateConfiguration = this.getWorkspaceConsolidatedConfiguration();\n      const folderConfiguration = this._folderConfigurations.get(folder);\n      if (folderConfiguration) {\n        folderConsolidatedConfiguration = workspaceConsolidateConfiguration.merge(folderConfiguration);\n        this._foldersConsolidatedConfigurations.set(folder, folderConsolidatedConfiguration);\n      } else {\n        folderConsolidatedConfiguration = workspaceConsolidateConfiguration;\n      }\n    }\n    return folderConsolidatedConfiguration;\n  }\n  getFolderConfigurationModelForResource(resource, workspace) {\n    if (workspace && resource) {\n      const root = workspace.getFolder(resource);\n      if (root) {\n        return this._folderConfigurations.get(root.uri);\n      }\n    }\n    return undefined;\n  }\n  toData() {\n    return {\n      defaults: {\n        contents: this._defaultConfiguration.contents,\n        overrides: this._defaultConfiguration.overrides,\n        keys: this._defaultConfiguration.keys\n      },\n      policy: {\n        contents: this._policyConfiguration.contents,\n        overrides: this._policyConfiguration.overrides,\n        keys: this._policyConfiguration.keys\n      },\n      application: {\n        contents: this.applicationConfiguration.contents,\n        overrides: this.applicationConfiguration.overrides,\n        keys: this.applicationConfiguration.keys\n      },\n      user: {\n        contents: this.userConfiguration.contents,\n        overrides: this.userConfiguration.overrides,\n        keys: this.userConfiguration.keys\n      },\n      workspace: {\n        contents: this._workspaceConfiguration.contents,\n        overrides: this._workspaceConfiguration.overrides,\n        keys: this._workspaceConfiguration.keys\n      },\n      folders: [...this._folderConfigurations.keys()].reduce((result, folder) => {\n        const {\n          contents,\n          overrides,\n          keys\n        } = this._folderConfigurations.get(folder);\n        result.push([folder, {\n          contents,\n          overrides,\n          keys\n        }]);\n        return result;\n      }, [])\n    };\n  }\n  static parse(data, logService) {\n    const defaultConfiguration = this.parseConfigurationModel(data.defaults, logService);\n    const policyConfiguration = this.parseConfigurationModel(data.policy, logService);\n    const applicationConfiguration = this.parseConfigurationModel(data.application, logService);\n    const userConfiguration = this.parseConfigurationModel(data.user, logService);\n    const workspaceConfiguration = this.parseConfigurationModel(data.workspace, logService);\n    const folders = data.folders.reduce((result, value) => {\n      result.set(URI.revive(value[0]), this.parseConfigurationModel(value[1], logService));\n      return result;\n    }, new ResourceMap());\n    return new Configuration(defaultConfiguration, policyConfiguration, applicationConfiguration, userConfiguration, ConfigurationModel.createEmptyModel(logService), workspaceConfiguration, folders, ConfigurationModel.createEmptyModel(logService), new ResourceMap(), logService);\n  }\n  static parseConfigurationModel(model, logService) {\n    return new ConfigurationModel(model.contents, model.keys, model.overrides, undefined, logService);\n  }\n}\nexport class ConfigurationChangeEvent {\n  constructor(change, previous, currentConfiguraiton, currentWorkspace, logService) {\n    this.change = change;\n    this.previous = previous;\n    this.currentConfiguraiton = currentConfiguraiton;\n    this.currentWorkspace = currentWorkspace;\n    this.logService = logService;\n    this._marker = '\\n';\n    this._markerCode1 = this._marker.charCodeAt(0);\n    this._markerCode2 = '.'.charCodeAt(0);\n    this.affectedKeys = new Set();\n    this._previousConfiguration = undefined;\n    for (const key of change.keys) {\n      this.affectedKeys.add(key);\n    }\n    for (const [, keys] of change.overrides) {\n      for (const key of keys) {\n        this.affectedKeys.add(key);\n      }\n    }\n    // Example: '\\nfoo.bar\\nabc.def\\n'\n    this._affectsConfigStr = this._marker;\n    for (const key of this.affectedKeys) {\n      this._affectsConfigStr += key + this._marker;\n    }\n  }\n  get previousConfiguration() {\n    if (!this._previousConfiguration && this.previous) {\n      this._previousConfiguration = Configuration.parse(this.previous.data, this.logService);\n    }\n    return this._previousConfiguration;\n  }\n  affectsConfiguration(section, overrides) {\n    var _a;\n    // we have one large string with all keys that have changed. we pad (marker) the section\n    // and check that either find it padded or before a segment character\n    const needle = this._marker + section;\n    const idx = this._affectsConfigStr.indexOf(needle);\n    if (idx < 0) {\n      // NOT: (marker + section)\n      return false;\n    }\n    const pos = idx + needle.length;\n    if (pos >= this._affectsConfigStr.length) {\n      return false;\n    }\n    const code = this._affectsConfigStr.charCodeAt(pos);\n    if (code !== this._markerCode1 && code !== this._markerCode2) {\n      // NOT: section + (marker | segment)\n      return false;\n    }\n    if (overrides) {\n      const value1 = this.previousConfiguration ? this.previousConfiguration.getValue(section, overrides, (_a = this.previous) === null || _a === void 0 ? void 0 : _a.workspace) : undefined;\n      const value2 = this.currentConfiguraiton.getValue(section, overrides, this.currentWorkspace);\n      return !objects.equals(value1, value2);\n    }\n    return true;\n  }\n}","map":{"version":3,"names":["arrays","ResourceMap","objects","types","URI","addToValueTree","getConfigurationValue","removeFromValueTree","toValuesTree","Extensions","overrideIdentifiersFromKey","OVERRIDE_PROPERTY_REGEX","Registry","freeze","data","Object","isFrozen","deepFreeze","ConfigurationModel","createEmptyModel","logService","undefined","constructor","_contents","_keys","_overrides","raw","overrideConfigurations","Map","rawConfiguration","_a","_rawConfiguration","length","rawConfigurationModels","map","parser","ConfigurationModelParser","parseRaw","configurationModel","reduce","previous","current","merge","contents","overrides","keys","isEmpty","getValue","section","inspect","overrideIdentifier","that","value","override","getOverrideValue","merged","identifiers","push","overrideContents","getContentsForOverrideIdentifer","identifier","overrideConfigurationModel","get","createOverrideConfigurationModel","set","_b","deepClone","raws","_len","arguments","others","Array","_key","other","mergeContents","otherOverride","filter","o","equals","distinct","key","indexOf","every","contentsForKey","overrideContentsForKey","source","target","isObject","contentsForIdentifierOnly","contentsToMerge","includes","toJSON","addValue","updateValue","setValue","removeValue","index","splice","test","findIndex","add","e","error","message","_name","_raw","_configurationModel","_restrictedConfigurations","options","restricted","hasExcludedProperties","doParseRaw","configurationProperties","as","Configuration","getConfigurationProperties","filtered","toOverrides","properties","filterOverriddenProperties","_c","scopes","skipRestricted","exclude","result","propertySchema","scope","include","conflictReporter","overrideRaw","keyInOverrideRaw","ConfigurationInspectValue","_value","overrideIdentifiers","defaultConfiguration","policyConfiguration","applicationConfiguration","userConfiguration","localUserConfiguration","remoteUserConfiguration","workspaceConfiguration","folderConfigurationModel","memoryConfigurationModel","toInspectValue","inspectValue","userInspectValue","_userInspectValue","user","_defaultConfiguration","_policyConfiguration","_applicationConfiguration","_localUserConfiguration","_remoteUserConfiguration","_workspaceConfiguration","_folderConfigurations","_memoryConfiguration","_memoryConfigurationByResource","_workspaceConsolidatedConfiguration","_foldersConsolidatedConfigurations","_userConfiguration","workspace","consolidateConfigurationModel","getConsolidatedConfigurationModel","memoryConfiguration","resource","getFolderConfigurationModelForResource","Set","size","getConsolidatedConfigurationModelForResource","_ref","consolidateConfiguration","getWorkspaceConsolidatedConfiguration","root","getFolder","getFolderConsolidatedConfiguration","uri","memoryConfigurationForResource","folder","folderConsolidatedConfiguration","workspaceConsolidateConfiguration","folderConfiguration","toData","defaults","policy","application","folders","parse","parseConfigurationModel","revive","model","ConfigurationChangeEvent","change","currentConfiguraiton","currentWorkspace","_marker","_markerCode1","charCodeAt","_markerCode2","affectedKeys","_previousConfiguration","_affectsConfigStr","previousConfiguration","affectsConfiguration","needle","idx","pos","code","value1","value2"],"sources":["/home/arslan/modojo/node_modules/monaco-editor/esm/vs/platform/configuration/common/configurationModels.js"],"sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport * as arrays from '../../../base/common/arrays.js';\nimport { ResourceMap } from '../../../base/common/map.js';\nimport * as objects from '../../../base/common/objects.js';\nimport * as types from '../../../base/common/types.js';\nimport { URI } from '../../../base/common/uri.js';\nimport { addToValueTree, getConfigurationValue, removeFromValueTree, toValuesTree } from './configuration.js';\nimport { Extensions, overrideIdentifiersFromKey, OVERRIDE_PROPERTY_REGEX } from './configurationRegistry.js';\nimport { Registry } from '../../registry/common/platform.js';\nfunction freeze(data) {\n    return Object.isFrozen(data) ? data : objects.deepFreeze(data);\n}\nexport class ConfigurationModel {\n    static createEmptyModel(logService) {\n        return new ConfigurationModel({}, [], [], undefined, logService);\n    }\n    constructor(_contents, _keys, _overrides, raw, logService) {\n        this._contents = _contents;\n        this._keys = _keys;\n        this._overrides = _overrides;\n        this.raw = raw;\n        this.logService = logService;\n        this.overrideConfigurations = new Map();\n    }\n    get rawConfiguration() {\n        var _a;\n        if (!this._rawConfiguration) {\n            if ((_a = this.raw) === null || _a === void 0 ? void 0 : _a.length) {\n                const rawConfigurationModels = this.raw.map(raw => {\n                    if (raw instanceof ConfigurationModel) {\n                        return raw;\n                    }\n                    const parser = new ConfigurationModelParser('', this.logService);\n                    parser.parseRaw(raw);\n                    return parser.configurationModel;\n                });\n                this._rawConfiguration = rawConfigurationModels.reduce((previous, current) => current === previous ? current : previous.merge(current), rawConfigurationModels[0]);\n            }\n            else {\n                // raw is same as current\n                this._rawConfiguration = this;\n            }\n        }\n        return this._rawConfiguration;\n    }\n    get contents() {\n        return this._contents;\n    }\n    get overrides() {\n        return this._overrides;\n    }\n    get keys() {\n        return this._keys;\n    }\n    isEmpty() {\n        return this._keys.length === 0 && Object.keys(this._contents).length === 0 && this._overrides.length === 0;\n    }\n    getValue(section) {\n        return section ? getConfigurationValue(this.contents, section) : this.contents;\n    }\n    inspect(section, overrideIdentifier) {\n        const that = this;\n        return {\n            get value() {\n                return freeze(that.rawConfiguration.getValue(section));\n            },\n            get override() {\n                return overrideIdentifier ? freeze(that.rawConfiguration.getOverrideValue(section, overrideIdentifier)) : undefined;\n            },\n            get merged() {\n                return freeze(overrideIdentifier ? that.rawConfiguration.override(overrideIdentifier).getValue(section) : that.rawConfiguration.getValue(section));\n            },\n            get overrides() {\n                const overrides = [];\n                for (const { contents, identifiers, keys } of that.rawConfiguration.overrides) {\n                    const value = new ConfigurationModel(contents, keys, [], undefined, that.logService).getValue(section);\n                    if (value !== undefined) {\n                        overrides.push({ identifiers, value });\n                    }\n                }\n                return overrides.length ? freeze(overrides) : undefined;\n            }\n        };\n    }\n    getOverrideValue(section, overrideIdentifier) {\n        const overrideContents = this.getContentsForOverrideIdentifer(overrideIdentifier);\n        return overrideContents\n            ? section ? getConfigurationValue(overrideContents, section) : overrideContents\n            : undefined;\n    }\n    override(identifier) {\n        let overrideConfigurationModel = this.overrideConfigurations.get(identifier);\n        if (!overrideConfigurationModel) {\n            overrideConfigurationModel = this.createOverrideConfigurationModel(identifier);\n            this.overrideConfigurations.set(identifier, overrideConfigurationModel);\n        }\n        return overrideConfigurationModel;\n    }\n    merge(...others) {\n        var _a, _b;\n        const contents = objects.deepClone(this.contents);\n        const overrides = objects.deepClone(this.overrides);\n        const keys = [...this.keys];\n        const raws = ((_a = this.raw) === null || _a === void 0 ? void 0 : _a.length) ? [...this.raw] : [this];\n        for (const other of others) {\n            raws.push(...(((_b = other.raw) === null || _b === void 0 ? void 0 : _b.length) ? other.raw : [other]));\n            if (other.isEmpty()) {\n                continue;\n            }\n            this.mergeContents(contents, other.contents);\n            for (const otherOverride of other.overrides) {\n                const [override] = overrides.filter(o => arrays.equals(o.identifiers, otherOverride.identifiers));\n                if (override) {\n                    this.mergeContents(override.contents, otherOverride.contents);\n                    override.keys.push(...otherOverride.keys);\n                    override.keys = arrays.distinct(override.keys);\n                }\n                else {\n                    overrides.push(objects.deepClone(otherOverride));\n                }\n            }\n            for (const key of other.keys) {\n                if (keys.indexOf(key) === -1) {\n                    keys.push(key);\n                }\n            }\n        }\n        return new ConfigurationModel(contents, keys, overrides, raws.every(raw => raw instanceof ConfigurationModel) ? undefined : raws, this.logService);\n    }\n    createOverrideConfigurationModel(identifier) {\n        const overrideContents = this.getContentsForOverrideIdentifer(identifier);\n        if (!overrideContents || typeof overrideContents !== 'object' || !Object.keys(overrideContents).length) {\n            // If there are no valid overrides, return self\n            return this;\n        }\n        const contents = {};\n        for (const key of arrays.distinct([...Object.keys(this.contents), ...Object.keys(overrideContents)])) {\n            let contentsForKey = this.contents[key];\n            const overrideContentsForKey = overrideContents[key];\n            // If there are override contents for the key, clone and merge otherwise use base contents\n            if (overrideContentsForKey) {\n                // Clone and merge only if base contents and override contents are of type object otherwise just override\n                if (typeof contentsForKey === 'object' && typeof overrideContentsForKey === 'object') {\n                    contentsForKey = objects.deepClone(contentsForKey);\n                    this.mergeContents(contentsForKey, overrideContentsForKey);\n                }\n                else {\n                    contentsForKey = overrideContentsForKey;\n                }\n            }\n            contents[key] = contentsForKey;\n        }\n        return new ConfigurationModel(contents, this.keys, this.overrides, undefined, this.logService);\n    }\n    mergeContents(source, target) {\n        for (const key of Object.keys(target)) {\n            if (key in source) {\n                if (types.isObject(source[key]) && types.isObject(target[key])) {\n                    this.mergeContents(source[key], target[key]);\n                    continue;\n                }\n            }\n            source[key] = objects.deepClone(target[key]);\n        }\n    }\n    getContentsForOverrideIdentifer(identifier) {\n        let contentsForIdentifierOnly = null;\n        let contents = null;\n        const mergeContents = (contentsToMerge) => {\n            if (contentsToMerge) {\n                if (contents) {\n                    this.mergeContents(contents, contentsToMerge);\n                }\n                else {\n                    contents = objects.deepClone(contentsToMerge);\n                }\n            }\n        };\n        for (const override of this.overrides) {\n            if (override.identifiers.length === 1 && override.identifiers[0] === identifier) {\n                contentsForIdentifierOnly = override.contents;\n            }\n            else if (override.identifiers.includes(identifier)) {\n                mergeContents(override.contents);\n            }\n        }\n        // Merge contents of the identifier only at the end to take precedence.\n        mergeContents(contentsForIdentifierOnly);\n        return contents;\n    }\n    toJSON() {\n        return {\n            contents: this.contents,\n            overrides: this.overrides,\n            keys: this.keys\n        };\n    }\n    // Update methods\n    addValue(key, value) {\n        this.updateValue(key, value, true);\n    }\n    setValue(key, value) {\n        this.updateValue(key, value, false);\n    }\n    removeValue(key) {\n        const index = this.keys.indexOf(key);\n        if (index === -1) {\n            return;\n        }\n        this.keys.splice(index, 1);\n        removeFromValueTree(this.contents, key);\n        if (OVERRIDE_PROPERTY_REGEX.test(key)) {\n            this.overrides.splice(this.overrides.findIndex(o => arrays.equals(o.identifiers, overrideIdentifiersFromKey(key))), 1);\n        }\n    }\n    updateValue(key, value, add) {\n        addToValueTree(this.contents, key, value, e => this.logService.error(e));\n        add = add || this.keys.indexOf(key) === -1;\n        if (add) {\n            this.keys.push(key);\n        }\n        if (OVERRIDE_PROPERTY_REGEX.test(key)) {\n            this.overrides.push({\n                identifiers: overrideIdentifiersFromKey(key),\n                keys: Object.keys(this.contents[key]),\n                contents: toValuesTree(this.contents[key], message => this.logService.error(message)),\n            });\n        }\n    }\n}\nexport class ConfigurationModelParser {\n    constructor(_name, logService) {\n        this._name = _name;\n        this.logService = logService;\n        this._raw = null;\n        this._configurationModel = null;\n        this._restrictedConfigurations = [];\n    }\n    get configurationModel() {\n        return this._configurationModel || ConfigurationModel.createEmptyModel(this.logService);\n    }\n    parseRaw(raw, options) {\n        this._raw = raw;\n        const { contents, keys, overrides, restricted, hasExcludedProperties } = this.doParseRaw(raw, options);\n        this._configurationModel = new ConfigurationModel(contents, keys, overrides, hasExcludedProperties ? [raw] : undefined /* raw has not changed */, this.logService);\n        this._restrictedConfigurations = restricted || [];\n    }\n    doParseRaw(raw, options) {\n        const configurationProperties = Registry.as(Extensions.Configuration).getConfigurationProperties();\n        const filtered = this.filter(raw, configurationProperties, true, options);\n        raw = filtered.raw;\n        const contents = toValuesTree(raw, message => this.logService.error(`Conflict in settings file ${this._name}: ${message}`));\n        const keys = Object.keys(raw);\n        const overrides = this.toOverrides(raw, message => this.logService.error(`Conflict in settings file ${this._name}: ${message}`));\n        return { contents, keys, overrides, restricted: filtered.restricted, hasExcludedProperties: filtered.hasExcludedProperties };\n    }\n    filter(properties, configurationProperties, filterOverriddenProperties, options) {\n        var _a, _b, _c;\n        let hasExcludedProperties = false;\n        if (!(options === null || options === void 0 ? void 0 : options.scopes) && !(options === null || options === void 0 ? void 0 : options.skipRestricted) && !((_a = options === null || options === void 0 ? void 0 : options.exclude) === null || _a === void 0 ? void 0 : _a.length)) {\n            return { raw: properties, restricted: [], hasExcludedProperties };\n        }\n        const raw = {};\n        const restricted = [];\n        for (const key in properties) {\n            if (OVERRIDE_PROPERTY_REGEX.test(key) && filterOverriddenProperties) {\n                const result = this.filter(properties[key], configurationProperties, false, options);\n                raw[key] = result.raw;\n                hasExcludedProperties = hasExcludedProperties || result.hasExcludedProperties;\n                restricted.push(...result.restricted);\n            }\n            else {\n                const propertySchema = configurationProperties[key];\n                const scope = propertySchema ? typeof propertySchema.scope !== 'undefined' ? propertySchema.scope : 3 /* ConfigurationScope.WINDOW */ : undefined;\n                if (propertySchema === null || propertySchema === void 0 ? void 0 : propertySchema.restricted) {\n                    restricted.push(key);\n                }\n                if (!((_b = options.exclude) === null || _b === void 0 ? void 0 : _b.includes(key)) /* Check exclude */\n                    && (((_c = options.include) === null || _c === void 0 ? void 0 : _c.includes(key) /* Check include */)\n                        || ((scope === undefined || options.scopes === undefined || options.scopes.includes(scope)) /* Check scopes */\n                            && !(options.skipRestricted && (propertySchema === null || propertySchema === void 0 ? void 0 : propertySchema.restricted))))) /* Check restricted */ {\n                    raw[key] = properties[key];\n                }\n                else {\n                    hasExcludedProperties = true;\n                }\n            }\n        }\n        return { raw, restricted, hasExcludedProperties };\n    }\n    toOverrides(raw, conflictReporter) {\n        const overrides = [];\n        for (const key of Object.keys(raw)) {\n            if (OVERRIDE_PROPERTY_REGEX.test(key)) {\n                const overrideRaw = {};\n                for (const keyInOverrideRaw in raw[key]) {\n                    overrideRaw[keyInOverrideRaw] = raw[key][keyInOverrideRaw];\n                }\n                overrides.push({\n                    identifiers: overrideIdentifiersFromKey(key),\n                    keys: Object.keys(overrideRaw),\n                    contents: toValuesTree(overrideRaw, conflictReporter)\n                });\n            }\n        }\n        return overrides;\n    }\n}\nclass ConfigurationInspectValue {\n    constructor(key, overrides, _value, overrideIdentifiers, defaultConfiguration, policyConfiguration, applicationConfiguration, userConfiguration, localUserConfiguration, remoteUserConfiguration, workspaceConfiguration, folderConfigurationModel, memoryConfigurationModel) {\n        this.key = key;\n        this.overrides = overrides;\n        this._value = _value;\n        this.overrideIdentifiers = overrideIdentifiers;\n        this.defaultConfiguration = defaultConfiguration;\n        this.policyConfiguration = policyConfiguration;\n        this.applicationConfiguration = applicationConfiguration;\n        this.userConfiguration = userConfiguration;\n        this.localUserConfiguration = localUserConfiguration;\n        this.remoteUserConfiguration = remoteUserConfiguration;\n        this.workspaceConfiguration = workspaceConfiguration;\n        this.folderConfigurationModel = folderConfigurationModel;\n        this.memoryConfigurationModel = memoryConfigurationModel;\n    }\n    toInspectValue(inspectValue) {\n        return (inspectValue === null || inspectValue === void 0 ? void 0 : inspectValue.value) !== undefined || (inspectValue === null || inspectValue === void 0 ? void 0 : inspectValue.override) !== undefined || (inspectValue === null || inspectValue === void 0 ? void 0 : inspectValue.overrides) !== undefined ? inspectValue : undefined;\n    }\n    get userInspectValue() {\n        if (!this._userInspectValue) {\n            this._userInspectValue = this.userConfiguration.inspect(this.key, this.overrides.overrideIdentifier);\n        }\n        return this._userInspectValue;\n    }\n    get user() {\n        return this.toInspectValue(this.userInspectValue);\n    }\n}\nexport class Configuration {\n    constructor(_defaultConfiguration, _policyConfiguration, _applicationConfiguration, _localUserConfiguration, _remoteUserConfiguration, _workspaceConfiguration, _folderConfigurations, _memoryConfiguration, _memoryConfigurationByResource, logService) {\n        this._defaultConfiguration = _defaultConfiguration;\n        this._policyConfiguration = _policyConfiguration;\n        this._applicationConfiguration = _applicationConfiguration;\n        this._localUserConfiguration = _localUserConfiguration;\n        this._remoteUserConfiguration = _remoteUserConfiguration;\n        this._workspaceConfiguration = _workspaceConfiguration;\n        this._folderConfigurations = _folderConfigurations;\n        this._memoryConfiguration = _memoryConfiguration;\n        this._memoryConfigurationByResource = _memoryConfigurationByResource;\n        this.logService = logService;\n        this._workspaceConsolidatedConfiguration = null;\n        this._foldersConsolidatedConfigurations = new ResourceMap();\n        this._userConfiguration = null;\n    }\n    getValue(section, overrides, workspace) {\n        const consolidateConfigurationModel = this.getConsolidatedConfigurationModel(section, overrides, workspace);\n        return consolidateConfigurationModel.getValue(section);\n    }\n    updateValue(key, value, overrides = {}) {\n        let memoryConfiguration;\n        if (overrides.resource) {\n            memoryConfiguration = this._memoryConfigurationByResource.get(overrides.resource);\n            if (!memoryConfiguration) {\n                memoryConfiguration = ConfigurationModel.createEmptyModel(this.logService);\n                this._memoryConfigurationByResource.set(overrides.resource, memoryConfiguration);\n            }\n        }\n        else {\n            memoryConfiguration = this._memoryConfiguration;\n        }\n        if (value === undefined) {\n            memoryConfiguration.removeValue(key);\n        }\n        else {\n            memoryConfiguration.setValue(key, value);\n        }\n        if (!overrides.resource) {\n            this._workspaceConsolidatedConfiguration = null;\n        }\n    }\n    inspect(key, overrides, workspace) {\n        const consolidateConfigurationModel = this.getConsolidatedConfigurationModel(key, overrides, workspace);\n        const folderConfigurationModel = this.getFolderConfigurationModelForResource(overrides.resource, workspace);\n        const memoryConfigurationModel = overrides.resource ? this._memoryConfigurationByResource.get(overrides.resource) || this._memoryConfiguration : this._memoryConfiguration;\n        const overrideIdentifiers = new Set();\n        for (const override of consolidateConfigurationModel.overrides) {\n            for (const overrideIdentifier of override.identifiers) {\n                if (consolidateConfigurationModel.getOverrideValue(key, overrideIdentifier) !== undefined) {\n                    overrideIdentifiers.add(overrideIdentifier);\n                }\n            }\n        }\n        return new ConfigurationInspectValue(key, overrides, consolidateConfigurationModel.getValue(key), overrideIdentifiers.size ? [...overrideIdentifiers] : undefined, this._defaultConfiguration, this._policyConfiguration.isEmpty() ? undefined : this._policyConfiguration, this.applicationConfiguration.isEmpty() ? undefined : this.applicationConfiguration, this.userConfiguration, this.localUserConfiguration, this.remoteUserConfiguration, workspace ? this._workspaceConfiguration : undefined, folderConfigurationModel ? folderConfigurationModel : undefined, memoryConfigurationModel);\n    }\n    get applicationConfiguration() {\n        return this._applicationConfiguration;\n    }\n    get userConfiguration() {\n        if (!this._userConfiguration) {\n            this._userConfiguration = this._remoteUserConfiguration.isEmpty() ? this._localUserConfiguration : this._localUserConfiguration.merge(this._remoteUserConfiguration);\n        }\n        return this._userConfiguration;\n    }\n    get localUserConfiguration() {\n        return this._localUserConfiguration;\n    }\n    get remoteUserConfiguration() {\n        return this._remoteUserConfiguration;\n    }\n    getConsolidatedConfigurationModel(section, overrides, workspace) {\n        let configurationModel = this.getConsolidatedConfigurationModelForResource(overrides, workspace);\n        if (overrides.overrideIdentifier) {\n            configurationModel = configurationModel.override(overrides.overrideIdentifier);\n        }\n        if (!this._policyConfiguration.isEmpty() && this._policyConfiguration.getValue(section) !== undefined) {\n            configurationModel = configurationModel.merge(this._policyConfiguration);\n        }\n        return configurationModel;\n    }\n    getConsolidatedConfigurationModelForResource({ resource }, workspace) {\n        let consolidateConfiguration = this.getWorkspaceConsolidatedConfiguration();\n        if (workspace && resource) {\n            const root = workspace.getFolder(resource);\n            if (root) {\n                consolidateConfiguration = this.getFolderConsolidatedConfiguration(root.uri) || consolidateConfiguration;\n            }\n            const memoryConfigurationForResource = this._memoryConfigurationByResource.get(resource);\n            if (memoryConfigurationForResource) {\n                consolidateConfiguration = consolidateConfiguration.merge(memoryConfigurationForResource);\n            }\n        }\n        return consolidateConfiguration;\n    }\n    getWorkspaceConsolidatedConfiguration() {\n        if (!this._workspaceConsolidatedConfiguration) {\n            this._workspaceConsolidatedConfiguration = this._defaultConfiguration.merge(this.applicationConfiguration, this.userConfiguration, this._workspaceConfiguration, this._memoryConfiguration);\n        }\n        return this._workspaceConsolidatedConfiguration;\n    }\n    getFolderConsolidatedConfiguration(folder) {\n        let folderConsolidatedConfiguration = this._foldersConsolidatedConfigurations.get(folder);\n        if (!folderConsolidatedConfiguration) {\n            const workspaceConsolidateConfiguration = this.getWorkspaceConsolidatedConfiguration();\n            const folderConfiguration = this._folderConfigurations.get(folder);\n            if (folderConfiguration) {\n                folderConsolidatedConfiguration = workspaceConsolidateConfiguration.merge(folderConfiguration);\n                this._foldersConsolidatedConfigurations.set(folder, folderConsolidatedConfiguration);\n            }\n            else {\n                folderConsolidatedConfiguration = workspaceConsolidateConfiguration;\n            }\n        }\n        return folderConsolidatedConfiguration;\n    }\n    getFolderConfigurationModelForResource(resource, workspace) {\n        if (workspace && resource) {\n            const root = workspace.getFolder(resource);\n            if (root) {\n                return this._folderConfigurations.get(root.uri);\n            }\n        }\n        return undefined;\n    }\n    toData() {\n        return {\n            defaults: {\n                contents: this._defaultConfiguration.contents,\n                overrides: this._defaultConfiguration.overrides,\n                keys: this._defaultConfiguration.keys\n            },\n            policy: {\n                contents: this._policyConfiguration.contents,\n                overrides: this._policyConfiguration.overrides,\n                keys: this._policyConfiguration.keys\n            },\n            application: {\n                contents: this.applicationConfiguration.contents,\n                overrides: this.applicationConfiguration.overrides,\n                keys: this.applicationConfiguration.keys\n            },\n            user: {\n                contents: this.userConfiguration.contents,\n                overrides: this.userConfiguration.overrides,\n                keys: this.userConfiguration.keys\n            },\n            workspace: {\n                contents: this._workspaceConfiguration.contents,\n                overrides: this._workspaceConfiguration.overrides,\n                keys: this._workspaceConfiguration.keys\n            },\n            folders: [...this._folderConfigurations.keys()].reduce((result, folder) => {\n                const { contents, overrides, keys } = this._folderConfigurations.get(folder);\n                result.push([folder, { contents, overrides, keys }]);\n                return result;\n            }, [])\n        };\n    }\n    static parse(data, logService) {\n        const defaultConfiguration = this.parseConfigurationModel(data.defaults, logService);\n        const policyConfiguration = this.parseConfigurationModel(data.policy, logService);\n        const applicationConfiguration = this.parseConfigurationModel(data.application, logService);\n        const userConfiguration = this.parseConfigurationModel(data.user, logService);\n        const workspaceConfiguration = this.parseConfigurationModel(data.workspace, logService);\n        const folders = data.folders.reduce((result, value) => {\n            result.set(URI.revive(value[0]), this.parseConfigurationModel(value[1], logService));\n            return result;\n        }, new ResourceMap());\n        return new Configuration(defaultConfiguration, policyConfiguration, applicationConfiguration, userConfiguration, ConfigurationModel.createEmptyModel(logService), workspaceConfiguration, folders, ConfigurationModel.createEmptyModel(logService), new ResourceMap(), logService);\n    }\n    static parseConfigurationModel(model, logService) {\n        return new ConfigurationModel(model.contents, model.keys, model.overrides, undefined, logService);\n    }\n}\nexport class ConfigurationChangeEvent {\n    constructor(change, previous, currentConfiguraiton, currentWorkspace, logService) {\n        this.change = change;\n        this.previous = previous;\n        this.currentConfiguraiton = currentConfiguraiton;\n        this.currentWorkspace = currentWorkspace;\n        this.logService = logService;\n        this._marker = '\\n';\n        this._markerCode1 = this._marker.charCodeAt(0);\n        this._markerCode2 = '.'.charCodeAt(0);\n        this.affectedKeys = new Set();\n        this._previousConfiguration = undefined;\n        for (const key of change.keys) {\n            this.affectedKeys.add(key);\n        }\n        for (const [, keys] of change.overrides) {\n            for (const key of keys) {\n                this.affectedKeys.add(key);\n            }\n        }\n        // Example: '\\nfoo.bar\\nabc.def\\n'\n        this._affectsConfigStr = this._marker;\n        for (const key of this.affectedKeys) {\n            this._affectsConfigStr += key + this._marker;\n        }\n    }\n    get previousConfiguration() {\n        if (!this._previousConfiguration && this.previous) {\n            this._previousConfiguration = Configuration.parse(this.previous.data, this.logService);\n        }\n        return this._previousConfiguration;\n    }\n    affectsConfiguration(section, overrides) {\n        var _a;\n        // we have one large string with all keys that have changed. we pad (marker) the section\n        // and check that either find it padded or before a segment character\n        const needle = this._marker + section;\n        const idx = this._affectsConfigStr.indexOf(needle);\n        if (idx < 0) {\n            // NOT: (marker + section)\n            return false;\n        }\n        const pos = idx + needle.length;\n        if (pos >= this._affectsConfigStr.length) {\n            return false;\n        }\n        const code = this._affectsConfigStr.charCodeAt(pos);\n        if (code !== this._markerCode1 && code !== this._markerCode2) {\n            // NOT: section + (marker | segment)\n            return false;\n        }\n        if (overrides) {\n            const value1 = this.previousConfiguration ? this.previousConfiguration.getValue(section, overrides, (_a = this.previous) === null || _a === void 0 ? void 0 : _a.workspace) : undefined;\n            const value2 = this.currentConfiguraiton.getValue(section, overrides, this.currentWorkspace);\n            return !objects.equals(value1, value2);\n        }\n        return true;\n    }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}