{"ast":null,"code":"// src/context/AuthContext.js\nimport{createContext,useContext,useState,useEffect}from'react';import{AuthClient}from'@dfinity/auth-client';import{jsx as _jsx}from\"react/jsx-runtime\";const AuthContext=/*#__PURE__*/createContext();export const AuthProvider=_ref=>{let{children}=_ref;const[isAuthenticated,setIsAuthenticated]=useState(false);const[authClient,setAuthClient]=useState(null);const[isLoading,setIsLoading]=useState(true);const[userId,setUserId]=useState(null);// Initialize AuthClient and check authentication status\nconst initializeAuthClient=async()=>{try{const client=await AuthClient.create();setAuthClient(client);const isLoggedIn=await client.isAuthenticated();setIsAuthenticated(isLoggedIn);setIsLoading(false);if(isLoggedIn){const identity=client.getIdentity();const principal=identity.getPrincipal();setUserId(principal.toString());// Kullan覺c覺 ID'sini sakla\nconsole.log(\"User ID:\",principal.toString());}}catch(error){console.error(\"Failed to initialize AuthClient:\",error);// Error handling\n}};const handleLogin=async()=>{if(authClient){try{await authClient.login({identityProvider:'https://identity.ic0.app',onSuccess:()=>{setIsAuthenticated(true);// Update state on successful login\nconsole.log('User logged in:',true);// Debug log\n}});}catch(error){console.error(\"Login failed:\",error);// Error handling\n}}};const handleLogout=async()=>{if(authClient){try{await authClient.logout();setIsAuthenticated(false);setUserId(null);}catch(error){console.error(\"Logout failed:\",error);// Error handling\n}}};useEffect(()=>{initializeAuthClient();},[]);if(isLoading){return/*#__PURE__*/_jsx(\"div\",{children:\"Loading...\"});}return/*#__PURE__*/_jsx(AuthContext.Provider,{value:{isAuthenticated,handleLogin,handleLogout,authClient,userId},children:children});};export const useAuth=()=>useContext(AuthContext);","map":{"version":3,"names":["createContext","useContext","useState","useEffect","AuthClient","jsx","_jsx","AuthContext","AuthProvider","_ref","children","isAuthenticated","setIsAuthenticated","authClient","setAuthClient","isLoading","setIsLoading","userId","setUserId","initializeAuthClient","client","create","isLoggedIn","identity","getIdentity","principal","getPrincipal","toString","console","log","error","handleLogin","login","identityProvider","onSuccess","handleLogout","logout","Provider","value","useAuth"],"sources":["/home/arslan/modojo/src/modojo_frontend/src/context/AuthContext.js"],"sourcesContent":["// src/context/AuthContext.js\r\nimport { createContext, useContext, useState, useEffect } from 'react';\r\nimport { AuthClient } from '@dfinity/auth-client';\r\n\r\nconst AuthContext = createContext();\r\n\r\nexport const AuthProvider = ({ children }) => {\r\n  const [isAuthenticated, setIsAuthenticated] = useState(false);\r\n  const [authClient, setAuthClient] = useState(null);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [userId, setUserId] = useState(null);\r\n  // Initialize AuthClient and check authentication status\r\n  const initializeAuthClient = async () => {\r\n    try {\r\n      const client = await AuthClient.create();\r\n      setAuthClient(client);\r\n      const isLoggedIn = await client.isAuthenticated();\r\n      setIsAuthenticated(isLoggedIn); \r\n      setIsLoading(false);\r\n      if (isLoggedIn) {\r\n        const identity = client.getIdentity();\r\n        const principal = identity.getPrincipal();\r\n        setUserId(principal.toString());  // Kullan覺c覺 ID'sini sakla\r\n        console.log(\"User ID:\", principal.toString());\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Failed to initialize AuthClient:\", error); // Error handling\r\n    }\r\n  };\r\n\r\n  const handleLogin = async () => {\r\n    if (authClient) {\r\n      try {\r\n        await authClient.login({\r\n          identityProvider: 'https://identity.ic0.app',\r\n          onSuccess: () => {\r\n            setIsAuthenticated(true); // Update state on successful login\r\n            console.log('User logged in:', true); // Debug log\r\n          },\r\n        });\r\n      } catch (error) {\r\n        console.error(\"Login failed:\", error); // Error handling\r\n      }\r\n    }\r\n  };\r\n\r\n  const handleLogout = async () => {\r\n    if (authClient) {\r\n      try {\r\n        await authClient.logout();\r\n        setIsAuthenticated(false);\r\n        setUserId(null);  \r\n      } catch (error) {\r\n        console.error(\"Logout failed:\", error); // Error handling\r\n      }\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    initializeAuthClient(); \r\n  }, []);\r\n  if (isLoading) {\r\n    return <div>Loading...</div>; \r\n  }\r\n  return (\r\n    <AuthContext.Provider value={{ isAuthenticated, handleLogin, handleLogout, authClient, userId }}>\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n};\r\n\r\nexport const useAuth = () => useContext(AuthContext);\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}